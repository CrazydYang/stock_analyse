import{i as W}from"./index-1yOyFXf9.js";import{x as B,d as X,a as u,z as S,y as Y,c as w,e as m,f as x,g as N,w as f,i as h,E as k,b as n,F as P,A as R,k as Z,t as q,D as ee,o as i,_ as ae}from"./index-Do2I22sE.js";const E="/django/api/stock",te=async(M,c)=>{const y={};return(await B.get(`${E}/industry-sectors/`,{params:y})).data},le=async(M={})=>(await B.get(`${E}/industry/performance-reports/`,{params:M})).data,ne={class:"industry-analysis"},oe={class:"filter-row"},re={class:"filter-item"},se={class:"filter-item"},ue={class:"filter-item"},ie={class:"filter-item"},ce={class:"chart-header"},ve={class:"chart-info"},de={class:"info-item"},pe={class:"info-item"},_e={class:"info-item"},ge={class:"chart-container"},me={key:2,class:"loading-overlay"},fe=X({__name:"IndustryAnalysis",setup(M){const c=u(!1),y=u(),b=u(),d=u(),_=u(""),g=u("revenue"),I=u([]),l=u([]),V=u([{label:"年报",value:"annual"},{label:"中报",value:"semi_annual"},{label:"一季报",value:"q1"},{label:"三季报",value:"q3"},{label:"季报",value:"quarterly"}]),z=u([{label:"营业收入",value:"revenue"},{label:"净利润",value:"net_profit"},{label:"营业收入同比增长率",value:"revenue_growth"},{label:"净利润同比增长率",value:"profit_growth"},{label:"毛利率",value:"gross_margin"},{label:"净利率",value:"net_margin"},{label:"ROE",value:"roe"},{label:"ROA",value:"roa"}]),O=S(()=>d.value==="all"?"全部行业":I.value.find(e=>e.name===d.value)?.name||"未知行业"),L=S(()=>V.value.find(e=>e.value===_.value)?.label||"未选择"),p=S(()=>z.value.find(e=>e.value===g.value)?.label||"未选择"),A=S(()=>`${O.value} - ${p.value}趋势分析`),T=async()=>{c.value=!0;try{const a=await te();console.log("获取行业列表响应:",a),I.value=a.sectors,console.log("行业列表:",I.value),V.value.length>0&&(_.value=V.value[0].value),k.success("页面初始化完成")}catch(a){console.error("初始化数据失败:",a),k.error("初始化数据失败，请刷新页面重试")}finally{c.value=!1}},U=async()=>{if(!_.value||!g.value){k.warning("请选择季度和指标");return}c.value=!0;try{const a={report_type:_.value};d.value!=="all"&&(a.industry=d.value);const e=await le(a);$(e.aggregated_reports),await ee(),j(),k.success("数据加载完成")}catch(a){console.error("获取分析数据失败:",a),k.error("获取数据失败，请稍后重试")}finally{c.value=!1}},$=async a=>{l.value=a.map(e=>({quarter:e.report_date,value:F(e,g.value),growth_rate:G(e,g.value)}))},Q=a=>({Q1:1,中报:2,Q3:3,年报:4})[a]||0,F=(a,e)=>{const o={revenue:"total_operating_revenue",net_profit:"total_net_profit",revenue_growth:"avg_operating_revenue_growth_rate",profit_growth:"avg_net_profit_growth_rate",gross_margin:"avg_gross_profit_margin",net_margin:"avg_gross_profit_margin",roe:"avg_roe",roa:"avg_roe",eps:"avg_earnings_per_share",bvps:"avg_net_assets_per_share",ocfps:"avg_operating_cash_flow_per_share"}[e];return o&&a[o]||0},G=(a,e)=>{const o={revenue:"avg_operating_revenue_growth_rate",net_profit:"avg_net_profit_growth_rate",revenue_growth:"avg_operating_revenue_growth_rate",profit_growth:"avg_net_profit_growth_rate"}[e];return o&&a[o]||0},j=()=>{if(!y.value||l.value.length===0)return;b.value&&b.value.dispose(),b.value=W(y.value);let a;if(d.value==="all")if(l.value.length>0&&l.value[0].data){const r=[...new Set(l.value.flatMap(s=>s.data.map(v=>v.quarter)))].sort((s,v)=>Q(s)-Q(v)),o=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96","#fa8c16","#a0d911","#2f54eb"];a={title:{text:A.value,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:l.value.map(s=>s.name),top:"10%",type:"scroll"},grid:{top:"20%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:r,boundaryGap:!1},yAxis:{type:"value",name:p.value,nameTextStyle:{fontSize:12}},series:l.value.map((s,v)=>({name:s.name,type:"line",data:r.map(D=>{const C=s.data.find(t=>t.quarter===D);return C?C.value:null}),smooth:!0,connectNulls:!1,itemStyle:{color:o[v%o.length]},lineStyle:{color:o[v%o.length],width:2},symbol:"circle",symbolSize:6}))}}else a={title:{text:A.value,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:l.value.map(r=>r.name),axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:p.value},series:[{name:p.value,type:"bar",data:l.value.map(r=>r.value),itemStyle:{color:"#1890ff"}}]};else a={title:{text:A.value,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:l.value.map(e=>e.quarter)},yAxis:{type:"value",name:p.value},series:[{name:p.value,type:"line",data:l.value.map(e=>e.value),smooth:!0,itemStyle:{color:"#1890ff"},lineStyle:{color:"#1890ff"}}]};b.value.setOption(a)},H=()=>{l.value=[]},J=()=>{l.value=[]},K=()=>{l.value=[]};return Y(()=>{T()}),(a,e)=>{const r=h("el-option"),o=h("el-select"),s=h("el-button"),v=h("el-card"),D=h("el-empty"),C=h("el-loading");return i(),w("div",ne,[m(v,{class:"filter-panel",shadow:"hover"},{default:f(()=>[n("div",oe,[n("div",re,[e[3]||(e[3]=n("label",{class:"filter-label"},"选择行业：",-1)),m(o,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"请选择行业",style:{width:"200px"},onChange:H},{default:f(()=>[(i(!0),w(P,null,R(I.value,t=>(i(),x(r,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",se,[e[4]||(e[4]=n("label",{class:"filter-label"},"选择季度：",-1)),m(o,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"请选择季度",style:{width:"150px"},onChange:J},{default:f(()=>[(i(!0),w(P,null,R(V.value,t=>(i(),x(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",ue,[e[5]||(e[5]=n("label",{class:"filter-label"},"选择指标：",-1)),m(o,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),placeholder:"请选择指标",style:{width:"180px"},onChange:K},{default:f(()=>[(i(!0),w(P,null,R(z.value,t=>(i(),x(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",ie,[m(s,{type:"primary",loading:c.value,onClick:U},{default:f(()=>[...e[6]||(e[6]=[Z(" 查询分析 ",-1)])]),_:1},8,["loading"])])])]),_:1}),l.value.length>0?(i(),x(v,{key:0,class:"chart-panel",shadow:"hover"},{default:f(()=>[n("div",ce,[n("h3",null,q(A.value),1),n("div",ve,[n("span",de,"行业: "+q(O.value),1),n("span",pe,"季度: "+q(L.value),1),n("span",_e,"指标: "+q(p.value),1)])]),n("div",ge,[n("div",{ref_key:"chartRef",ref:y,class:"chart",style:{width:"100%",height:"500px"}},null,512)])]),_:1})):N("",!0),!c.value&&l.value.length===0?(i(),x(D,{key:1,description:"请选择筛选条件并点击查询分析按钮","image-size":200})):N("",!0),c.value?(i(),w("div",me,[m(C,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):N("",!0)])}}}),be=ae(fe,[["__scopeId","data-v-4accb164"]]);export{be as default};
