import{d as te,a as u,B as ae,C as ne,H as oe,I as le,c as C,b as l,g as D,f as R,e as n,w as o,i as r,E as g,l as v,L as se,k as P,t as d,S as z,F as B,A as re,D as N,T as ie,U as ce,V as ue,o as c,_ as de}from"./index-XyC3Z4x2.js";import{g as T}from"./strategyApi-SMgBgcmH.js";const _e={class:"index-rps-view","element-loading-text":"正在加载指数RPS数据..."},pe={class:"page-header"},fe={class:"header-content"},ge={class:"header-actions"},ve={key:0,class:"rps-data-section"},he={class:"table-header"},me={class:"table-controls"},we={class:"custom-header"},ye={class:"custom-header"},Se={class:"change-percent-cell"},Re={class:"trend-indicator"},xe={class:"custom-header"},be={class:"rps-cell"},ke={class:"table-footer"},Ce=te({__name:"IndexRpsView",setup(Pe){const h=u(!1),x=u(!1),_=u([]),V=u(""),b=u(""),p=u(["5","20","60"]),w=u(1),y=u(20),F=ae(()=>{let e=_.value;b.value&&(e=e.filter(f=>f.指数简称.includes(b.value)));const t=(w.value-1)*y.value,i=t+y.value;return e.slice(t,i)}),U=()=>p.value.length>0?`RPS_${p.value[0]}`:"",E=e=>e>=90?"#f56c6c":e>=80?"#e6a23c":e>=70?"#67c23a":"#909399",L=e=>e>=90?"极强":e>=80?"强势":e>=70?"良好":e>=50?"一般":"弱势",j=e=>e>=90?"rank-excellent":e>=80?"rank-strong":e>=70?"rank-good":e>=50?"rank-normal":"rank-weak",q=({row:e})=>{if(p.value.length>0){const t=e[`RPS_${p.value[0]}`];if(t>=90)return"row-excellent";if(t>=80)return"row-strong";if(t>=70)return"row-good"}return""},A=e=>{e.prop&&e.order&&_.value.sort((t,i)=>{const f=t[e.prop],k=i[e.prop];return e.order==="ascending"?f-k:k-f})},M=e=>{y.value=e,w.value=1},H=e=>{w.value=e},K=e=>{g({message:`${e.指数简称} (${e.指数代码})`,type:"info"})},G=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",I=async()=>{if(!h.value){h.value=!0;try{const e=p.value.join(","),t=await T(e);t.code===200?(_.value=t.data.data,V.value=t.data.query_time,g.success("RPS数据加载成功")):g.error(`加载失败: ${t.message}`)}catch(e){console.error("加载RPS数据失败:",e),g.error("加载RPS数据失败，请稍后重试")}finally{h.value=!1}}},J=async()=>{if(!x.value){x.value=!0;try{const e=p.value.join(","),t=await T(e,!0);if(t.code===200){const i=t.data.saved_count;g.success(`成功保存${i}条RPS数据到数据库`)}else g.error(`保存失败: ${t.message}`)}catch(e){console.error("保存RPS数据失败:",e),g.error("保存RPS数据失败，请稍后重试")}finally{x.value=!1}}};return ne(()=>{I()}),(e,t)=>{const i=r("el-button"),f=r("el-card"),k=r("el-input"),S=r("el-table-column"),O=r("el-tag"),m=r("el-icon"),$=r("el-tooltip"),Q=r("el-progress"),W=r("el-table"),X=r("el-pagination"),Y=r("el-empty"),Z=le("loading");return oe((c(),C("div",_e,[l("div",pe,[n(f,{shadow:"hover"},{default:o(()=>[l("div",fe,[t[5]||(t[5]=l("div",{class:"strategy-info"},[l("h1",{class:"strategy-title"},"指数RPS强度排名"),l("p",{class:"strategy-subtitle"},"板块轮动与强势指数分析")],-1)),l("div",ge,[n(i,{onClick:I,loading:h.value,icon:v(se),type:"primary"},{default:o(()=>[...t[3]||(t[3]=[P("刷新数据",-1)])]),_:1},8,["loading","icon"]),n(i,{onClick:J,loading:x.value,type:"success"},{default:o(()=>[...t[4]||(t[4]=[P("保存数据",-1)])]),_:1},8,["loading"])])])]),_:1})]),_.value.length>0?(c(),C("div",ve,[n(f,{shadow:"hover"},{header:o(()=>[l("div",he,[l("h3",null,"指数RPS强度排名 ("+d(G(V.value))+")",1),l("div",me,[n(k,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),placeholder:"搜索指数名称","prefix-icon":"Search",clearable:"",style:{width:"200px"}},null,8,["modelValue"])])])]),default:o(()=>[n(W,{data:F.value,stripe:"",border:"",style:{width:"100%"},"default-sort":{prop:U(),order:"descending"},height:"600","row-class-name":q,"highlight-current-row":"",onSortChange:A},{default:o(()=>[n(S,{type:"index",label:"#",width:"50",fixed:"left",align:"center"}),n(S,{prop:"指数代码",label:"指数代码",width:"100",sortable:"custom",fixed:"left",align:"center"},{default:o(a=>[n(O,{size:"small",effect:"plain"},{default:o(()=>[P(d(a.row.指数代码),1)]),_:2},1024)]),_:1}),n(S,{prop:"指数简称",label:"指数简称",width:"120",sortable:"custom",fixed:"left"},{header:o(()=>[l("div",we,[t[6]||(t[6]=l("span",null,"指数简称",-1)),n($,{content:"点击指数名称可查看详情",placement:"top"},{default:o(()=>[n(m,null,{default:o(()=>[n(v(z))]),_:1})]),_:1})])]),default:o(a=>[n(i,{type:"text",onClick:s=>K(a.row)},{default:o(()=>[P(d(a.row.指数简称),1)]),_:2},1032,["onClick"])]),_:1}),(c(!0),C(B,null,re(p.value,a=>(c(),C(B,{key:a},[n(S,{label:`${a}日涨跌幅`,width:"120",sortable:"custom",prop:`${a}日涨跌幅`,align:"center"},{header:o(()=>[l("div",ye,[l("span",null,d(a)+"日涨跌幅",1),n($,{content:`${a}日内的价格变化百分比`,placement:"top"},{default:o(()=>[n(m,null,{default:o(()=>[n(v(z))]),_:1})]),_:2},1032,["content"])])]),default:o(s=>[l("div",Se,[l("span",{class:N({up:s.row[`${a}日涨跌幅`]>0,down:s.row[`${a}日涨跌幅`]<0})},d(s.row[`${a}日涨跌幅`]>0?"+":"")+d(s.row[`${a}日涨跌幅`].toFixed(2))+"% ",3),l("div",Re,[s.row[`${a}日涨跌幅`]>0?(c(),R(m,{key:0},{default:o(()=>[n(v(ie))]),_:1})):s.row[`${a}日涨跌幅`]<0?(c(),R(m,{key:1},{default:o(()=>[n(v(ce))]),_:1})):(c(),R(m,{key:2},{default:o(()=>[n(v(ue))]),_:1}))])])]),_:2},1032,["label","prop"]),n(S,{label:`RPS_${a}`,width:"170",sortable:"custom",prop:`RPS_${a}`,align:"center"},{header:o(()=>[l("div",xe,[l("span",null,"RPS_"+d(a),1),n($,{content:"相对强度指标，值越高表示相对强度越强",placement:"top"},{default:o(()=>[n(m,null,{default:o(()=>[n(v(z))]),_:1})]),_:1})])]),default:o(s=>[l("div",be,[n(Q,{percentage:s.row[`RPS_${a}`],color:E(s.row[`RPS_${a}`]),format:ee=>ee.toFixed(1),"stroke-width":18,"text-inside":!0,"show-text":!0},null,8,["percentage","color","format"]),l("div",{class:N(["rps-rank",j(s.row[`RPS_${a}`])])},d(L(s.row[`RPS_${a}`])),3)])]),_:2},1032,["label","prop"])],64))),128))]),_:1},8,["data","default-sort"]),l("div",ke,[_.value.length>10?(c(),R(X,{key:0,layout:"total, sizes, prev, pager, next",total:_.value.length,"page-sizes":[10,20,50,100],"page-size":y.value,"onUpdate:pageSize":t[1]||(t[1]=a=>y.value=a),"current-page":w.value,"onUpdate:currentPage":t[2]||(t[2]=a=>w.value=a),onSizeChange:M,onCurrentChange:H},null,8,["total","page-size","current-page"])):D("",!0)])]),_:1})])):D("",!0),!h.value&&_.value.length===0?(c(),R(Y,{key:1,description:"暂无RPS数据"})):D("",!0)])),[[Z,h.value]])}}}),ze=de(Ce,[["__scopeId","data-v-043615c9"]]);export{ze as default};
