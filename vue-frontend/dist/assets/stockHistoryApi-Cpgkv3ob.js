import{d as A,a as L,I as x,y as N,O as m,P as B,c as D,b as C,g as K,t as O,Q as E,o as F,_ as M,x as S}from"./index-B66z1j89.js";import{i as I}from"./index-1yOyFXf9.js";const R={class:"stock-kline-chart-container"},Y={class:"chart-header"},P={key:0},V=A({__name:"StockKLineChart",props:{title:{default:""},stockCode:{},stockName:{default:""},klineData:{},tradeSignals:{default:()=>[]},height:{default:"600px"}},setup(r){E(d=>({"7a8900b8":e.height}));const e=r,n=L();let a=null;const s=()=>{n.value&&(a&&a.dispose(),a=I(n.value),g(),window.addEventListener("resize",v))},g=()=>{if(!a||!e.klineData||e.klineData.length===0)return;const d=e.klineData.map(t=>t.date),$=e.klineData.map(t=>[t.open_price,t.close_price,t.low_price,t.high_price]),h=t=>t?t.replace(/[^0-9]/g,""):"",k=new Map;d.forEach((t,f)=>{k.set(h(t),f)});const _=(t,f)=>{if(!t||!Array.isArray(t)||t.length===0)return[];const i=[...t].filter(o=>o.type===f).sort((o,u)=>{const c=h(o.date),l=h(u.date);return c.localeCompare(l)}),p=new Set;return console.log(`生成${f}信号标记，数量:`,i.length),f==="sell"&&console.log("卖出信号原始数据:",JSON.stringify(i)),i.map(o=>{const u=k.get(h(o.date));if(u===void 0)return console.log(`信号日期${o.date}不在K线数据范围内`),null;const c=h(o.date);if(p.has(c))return console.log(`日期${o.date}已有标记，跳过`),null;p.add(c);const l=f==="buy";return{name:l?"买入点":"卖出点",coord:[d[u],o.price],symbol:"arrow",symbolSize:50,symbolRotate:l?0:180,symbolOffset:[0,l?-100:20],value:o.price,itemStyle:{color:l?"#FF0000":"#00FF00",borderColor:"#fff",borderWidth:2},label:{show:!0,color:"#fff",backgroundColor:"rgba(255,0,0,0.7)",padding:[5,10],borderRadius:4,position:l?"top":"bottom",formatter:l?`买入
${o.price.toFixed(2)}元`:`卖出
${o.price.toFixed(2)}元`,fontSize:14,fontWeight:"bold"},tooltip:{formatter:l?`买入
价格: ${o.price.toFixed(2)}
${o.description||""}`:`卖出
价格: ${o.price.toFixed(2)}
${o.description||""}`}}}).filter(o=>o!==null)};console.log("更新图表，交易信号数量:",e.tradeSignals.length),console.log("交易信号详情:",JSON.stringify(e.tradeSignals));const w=_(e.tradeSignals,"buy"),y=_(e.tradeSignals,"sell");console.log("生成的买入信号数量:",w.length),console.log("生成的卖出信号数量:",y.length),console.log("卖出信号详情:",JSON.stringify(y));const z={title:{text:e.title||`${e.stockName}(${e.stockCode})K线图`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:t=>{let i=`<div style="font-weight:bold;margin-bottom:5px;">${t[0].axisValue}</div>`;return t.forEach(p=>{const o=p.color,u=p.seriesName,c=p.value;u==="K线"&&(i+=`<div style="color:${o};">${u}</div>`,i+=`<div>开盘价: ${c[0]}</div>`,i+=`<div>收盘价: ${c[1]}</div>`,i+=`<div>最低价: ${c[2]}</div>`,i+=`<div>最高价: ${c[3]}</div>`)}),i}},grid:{left:"10%",right:"10%",top:"15%",bottom:"15%"},xAxis:{type:"category",data:d,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1}},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",bottom:"5%",start:0,end:100}],series:[{name:"K线",type:"candlestick",data:$.map(t=>[t[0],t[1],t[3],t[2]]),markPoint:{symbol:"arrow",symbolSize:50,data:[...w,...y],clipByCoordinateSystem:!1,silent:!1,animation:!1,avoidLabelOverlap:!0,zlevel:10,emphasis:{disabled:!1},label:{fontSize:14,fontWeight:"bold",padding:[5,10],borderRadius:4,show:!0,formatter:function(t){return t.data&&t.data.name==="卖出点"?`卖出
${t.data.value.toFixed(2)}元`:t.data&&t.data.name==="买入点"?`买入
${t.data.value.toFixed(2)}元`:t.name}},itemStyle:{borderWidth:2,borderColor:"#fff",color:function(t){return t.data.name==="卖出点"?"#00FF00":"#FF0000"}}},itemStyle:{color:"#ec0000",color0:"#00da3c",borderColor:"#8A0000",borderColor0:"#008F28"}}]};a.setOption(z,!0)},v=()=>{a?.resize()};return x([()=>e.klineData,()=>e.tradeSignals],()=>{m(()=>{g()})},{deep:!0,immediate:!0}),x(()=>e.tradeSignals,()=>{m(()=>{g()})},{deep:!0,immediate:!0}),N(()=>{m(()=>{s()})}),B(()=>{a&&(a.dispose(),a=null),window.removeEventListener("resize",v)}),(d,$)=>(F(),D("div",R,[C("div",Y,[d.title?(F(),D("h3",P,O(d.title),1)):K("",!0)]),C("div",{ref_key:"chartContainer",ref:n,class:"chart-container"},null,512)]))}}),T=M(V,[["__scopeId","data-v-517c2dc2"]]),b="/django/api/individual_stock";async function U(r,e,n,a=""){try{const s={};return e&&(s.start_date=e),n&&(s.end_date=n),a&&(s.adjust=a),(await S.get(`${b}/stocks/${r}/history/`,{params:s})).data}catch(s){throw console.error(`获取股票 ${r} 历史数据失败:`,s),s}}async function Z(r){try{return(await S.get(`${b}/stocks/${r}/info/`)).data}catch(e){throw console.error(`获取股票 ${r} 详细信息失败:`,e),e}}async function j(r=1,e=20){try{const n={page:r.toString(),page_size:e.toString()},a=await S.get(`${b}/stocks/`,{params:n});return{total:a.data.total,data:a.data.data}}catch(n){throw console.error("获取股票列表失败:",n),n}}function G(r){const e=typeof r=="string"?new Date(r):r,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}${a}${s}`}function H(r){const e=new Date;return e.setDate(e.getDate()-r),e}export{T as S,j as a,Z as b,U as c,G as f,H as g};
