import{d as W,a as d,B as E,G as X,C as Y,H as Z,I as ee,c as x,b as o,g as V,f as F,e as a,w as n,i,E as k,l as ae,L as te,k as U,t as w,D as le,F as oe,A as ne,o as f,M as se,_ as re}from"./index-BlSsHgC1.js";import{a as ie}from"./strategyApi-B-bZn4lm.js";import{i as de}from"./index-1yOyFXf9.js";const ue={class:"historical-rps-view","element-loading-text":"正在加载历史RPS数据..."},ce={class:"page-header"},pe={class:"header-content"},ve={class:"header-actions"},_e={class:"query-section"},he={key:0,class:"historical-data-section"},me={class:"table-header"},fe={class:"table-controls"},ge={class:"pagination-container"},be={key:1,class:"chart-section"},ye={class:"chart-header"},xe={class:"chart-controls"},we={class:"chart-container",style:{height:"400px"}},Ce=W({__name:"HistoricalRpsView",setup(Se){const v=d(!1),u=d([]),z=d(0),b=d(1),r=d({period:20,limit:100,offset:0}),y=d(""),C=d(null),g=d(null),c=d(""),S=d(null),p=d([]),B=E(()=>y.value?u.value.filter(e=>e.index_name.includes(y.value)):u.value),H=E(()=>{const e=new Map;return u.value.forEach(t=>{e.has(t.index_code)||e.set(t.index_code,t)}),Array.from(e.values())}),N=e=>e>=90?"#f56c6c":e>=80?"#e6a23c":e>=70?"#67c23a":"#909399",D=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",_=async()=>{if(!v.value){v.value=!0;try{const e=await ie(r.value.period,r.value.limit,r.value.offset);e.code===200?(u.value=e.data.data,z.value=e.data.total,u.value.length>0&&!c.value&&(c.value=u.value[0].index_code,I()),k.success("历史RPS数据加载成功")):k.error(`加载失败: ${e.message}`)}catch(e){console.error("加载历史RPS数据失败:",e),k.error("加载历史RPS数据失败，请稍后重试")}finally{v.value=!1}}},M=e=>{r.value.limit=e,r.value.offset=0,b.value=1,_()},q=e=>{b.value=e,r.value.offset=(e-1)*r.value.limit,_()},I=()=>{c.value&&(S.value=u.value.find(e=>e.index_code===c.value)||null,p.value=u.value.filter(e=>e.index_code===c.value),A())},A=()=>{if(!C.value)return;g.value&&g.value.dispose(),g.value=de(C.value);const e=p.value.map(s=>D(s.created_at)),t=p.value.map(s=>s.rps_value),R=p.value.map(s=>s.change_percent),h={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["RPS值","涨跌幅"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value",name:"RPS值",min:0,max:100,position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"涨跌幅(%)",position:"right",axisLabel:{formatter:"{value}%"}}],series:[{name:"RPS值",type:"line",yAxisIndex:0,data:t,smooth:!0,lineStyle:{width:2},itemStyle:{color:"#409EFF"}},{name:"涨跌幅",type:"line",yAxisIndex:1,data:R,smooth:!0,lineStyle:{width:2},itemStyle:{color:"#67C23A"}}]};g.value.setOption(h),window.addEventListener("resize",()=>{g.value?.resize()})};return X(()=>p.value,()=>{p.value.length>0&&se(()=>{A()})}),Y(()=>{_()}),(e,t)=>{const R=i("el-button"),h=i("el-card"),s=i("el-option"),P=i("el-select"),L=i("el-form-item"),G=i("el-form"),T=i("el-input"),m=i("el-table-column"),j=i("el-progress"),K=i("el-table"),O=i("el-pagination"),$=i("el-empty"),J=ee("loading");return Z((f(),x("div",ue,[o("div",ce,[a(h,{shadow:"hover"},{default:n(()=>[o("div",pe,[t[7]||(t[7]=o("div",{class:"strategy-info"},[o("h1",{class:"strategy-title"},"历史RPS数据分析"),o("p",{class:"strategy-subtitle"},"指数强度历史趋势与变化")],-1)),o("div",ve,[a(R,{onClick:_,loading:v.value,icon:ae(te),type:"primary"},{default:n(()=>[...t[6]||(t[6]=[U("刷新数据",-1)])]),_:1},8,["loading","icon"])])])]),_:1})]),o("div",_e,[a(h,{shadow:"hover"},{header:n(()=>[...t[8]||(t[8]=[o("h3",null,"查询条件",-1)])]),default:n(()=>[a(G,{inline:!0},{default:n(()=>[a(L,{label:"RPS周期"},{default:n(()=>[a(P,{modelValue:r.value.period,"onUpdate:modelValue":t[0]||(t[0]=l=>r.value.period=l),placeholder:"选择RPS周期",onChange:_},{default:n(()=>[a(s,{label:"5日",value:5}),a(s,{label:"10日",value:10}),a(s,{label:"20日",value:20}),a(s,{label:"60日",value:60}),a(s,{label:"120日",value:120}),a(s,{label:"250日",value:250})]),_:1},8,["modelValue"])]),_:1}),a(L,{label:"数据量"},{default:n(()=>[a(P,{modelValue:r.value.limit,"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.limit=l),placeholder:"选择返回数量",onChange:_},{default:n(()=>[a(s,{label:"50条",value:50}),a(s,{label:"100条",value:100}),a(s,{label:"200条",value:200}),a(s,{label:"500条",value:500})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),u.value.length>0?(f(),x("div",he,[a(h,{shadow:"hover"},{header:n(()=>[o("div",me,[o("h3",null,"历史RPS数据 ("+w(r.value.period)+"日周期)",1),o("div",fe,[a(T,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=l=>y.value=l),placeholder:"搜索指数名称","prefix-icon":"Search",clearable:"",style:{width:"200px"}},null,8,["modelValue"])])])]),default:n(()=>[a(K,{data:B.value,stripe:"",border:"",style:{width:"100%"},"default-sort":{prop:"rps_value",order:"descending"},height:"600"},{default:n(()=>[a(m,{prop:"index_code",label:"指数代码",width:"100",sortable:""}),a(m,{prop:"index_name",label:"指数名称",width:"120",sortable:""}),a(m,{prop:"period",label:"周期(天)",width:"100",sortable:""}),a(m,{label:"涨跌幅",width:"120",sortable:"",prop:"change_percent"},{default:n(l=>[o("span",{class:le({up:l.row.change_percent>0,down:l.row.change_percent<0})},w(l.row.change_percent.toFixed(2))+"% ",3)]),_:1}),a(m,{label:"RPS值",width:"120",sortable:"",prop:"rps_value"},{default:n(l=>[a(j,{percentage:l.row.rps_value,color:N(l.row.rps_value),format:Q=>Q.toFixed(1),"stroke-width":10},null,8,["percentage","color","format"])]),_:1}),a(m,{prop:"created_at",label:"创建时间",width:"180",sortable:""},{default:n(l=>[U(w(D(l.row.created_at)),1)]),_:1})]),_:1},8,["data"]),o("div",ge,[a(O,{"current-page":b.value,"onUpdate:currentPage":t[3]||(t[3]=l=>b.value=l),"page-size":r.value.limit,"onUpdate:pageSize":t[4]||(t[4]=l=>r.value.limit=l),"page-sizes":[50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:M,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),_:1})])):V("",!0),p.value.length>0?(f(),x("div",be,[a(h,{shadow:"hover"},{header:n(()=>[o("div",ye,[o("h3",null,w(S.value?S.value.index_name:"")+" RPS趋势",1),o("div",xe,[a(P,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=l=>c.value=l),placeholder:"选择指数",onChange:I},{default:n(()=>[(f(!0),x(oe,null,ne(H.value,l=>(f(),F(s,{key:l.index_code,label:l.index_name,value:l.index_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:n(()=>[o("div",we,[o("div",{ref_key:"chartRef",ref:C,style:{width:"100%",height:"100%"}},null,512)])]),_:1})])):V("",!0),!v.value&&u.value.length===0?(f(),F($,{key:2,description:"暂无历史RPS数据"})):V("",!0)])),[[J,v.value]])}}}),ke=re(Ce,[["__scopeId","data-v-b045c53a"]]);export{ke as default};
