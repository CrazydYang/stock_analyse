import{x as D,d as $,a as k,z as A,y as E,c as R,b as e,e as n,w as s,i as w,t as r,u as F,j as B,k as V,C,o as I,_ as z}from"./index-B0xTQnUn.js";const N="/django/api/stock";function j(y){if(!y||y.length===0)return{avgChangePercent:0,avgPeRatio:0,avgPbRatio:0,avgChange60Day:0,avgChangeYtd:0};let _=0,d=0,h=0,t=0,l=0,m=0,g=0,p=0,P=0,b=0;return y.forEach(u=>{typeof u.change_percent=="number"&&(_+=u.change_percent,m++),typeof u.pe_ratio=="number"&&u.pe_ratio>0&&(d+=u.pe_ratio,g++),typeof u.pb_ratio=="number"&&u.pb_ratio>0&&(h+=u.pb_ratio,p++),typeof u.change_60day=="number"&&(t+=u.change_60day,P++),typeof u.change_ytd=="number"&&(l+=u.change_ytd,b++)}),{avgChangePercent:m>0?_/m:0,avgPeRatio:g>0?d/g:0,avgPbRatio:p>0?h/p:0,avgChange60Day:P>0?t/P:0,avgChangeYtd:b>0?l/b:0}}async function U(y){try{const _=await D.get(`${N}/industry-sectors/`);if(_.code!==200)throw new Error(_.message||"获取行业板块列表失败");const d=_.data.sectors.find(g=>g.name===y);if(!d)return console.warn(`未找到行业: ${y}`),null;const h=await D.get(`${N}/industry-sector/constituents/${d.code}/`);if(h.code!==200)throw new Error(h.message||"获取行业成分股失败");const t=h.data.constituents;let l=null;try{const g=await D.get(`${N}/industry-sector/realtime/${d.code}/`);g.code===200&&(l=g.data)}catch(g){console.warn(`获取行业 ${d.code} 实时行情失败:`,g)}const m=j(t);return{industry:d.name,code:d.code,count:d.stock_count,stocks:t,...m,latest_price:l?.latest_price||d.latest_price,change_amount:l?.change,change_percent:l?.change_percent||d.change_percent,open:l?.open,high:l?.high,low:l?.low,volume:l?.volume,amount:l?.amount,turnover_rate:l?.turnover_rate,rising_stocks:l?.rising_stocks,falling_stocks:l?.falling_stocks,unchanged_stocks:l?.unchanged_stocks}}catch(_){throw console.error("获取行业详情错误:",_),_}}const q={class:"industry-detail"},H={class:"page-header"},L={class:"header-content"},M={class:"page-title"},O={key:0,class:"detail-content"},T={class:"stats-section"},G={class:"stat-value"},J={class:"stat-value"},K={class:"stat-value"},Q={class:"stat-value"},W={class:"stat-value"},X={class:"stock-list-section"},Z={class:"section-header"},tt={class:"stock-count"},et={class:"table-container"},at=["href"],st={class:"stock-name"},nt={class:"market-cap"},ot={class:"price"},lt={class:"ratio"},rt={class:"ratio"},it={key:1,class:"error-container"},ct=$({__name:"IndustryDetail",setup(y){const _=B(),d=F(),h=k(!0),t=k(null),l=k(""),m=k("desc"),g=A(()=>!t.value||!l.value?t.value?.stocks||[]:[...t.value.stocks].sort((v,a)=>{const x=l.value;let i=v[x],c=a[x];return i==null&&(i=-1/0),c==null&&(c=-1/0),typeof i=="string"&&typeof c=="string"?m.value==="asc"?i.localeCompare(c):c.localeCompare(i):m.value==="asc"?i-c:c-i})),p=v=>v==null?"N/A":`${v.toFixed(2)}%`,P=v=>(v*.1).toFixed(2),b=()=>{d.push("/industries")},u=async()=>{try{h.value=!0;const v=decodeURIComponent(_.params.industry);if(console.log("industryName",v),!v)throw new Error("未指定行业名称");const a=await U(v);if(a)t.value=a;else throw new Error("未找到行业数据")}catch(v){console.error("获取行业数据失败:",v),t.value=null}finally{h.value=!1}};return E(()=>{u()}),(v,a)=>{const x=w("el-button"),i=w("el-card"),c=w("el-col"),Y=w("el-row"),f=w("el-table-column"),S=w("el-table");return I(),R("div",q,[e("div",H,[e("div",L,[n(x,{type:"default",size:"default",onClick:b,class:"back-button"},{icon:s(()=>[...a[0]||(a[0]=[e("span",null,"←",-1)])]),default:s(()=>[a[1]||(a[1]=V(" 返回行业分析 ",-1))]),_:1}),e("h1",M,r(t.value?.industry)+" - 行业详情",1)])]),t.value?(I(),R("div",O,[e("div",T,[n(Y,{gutter:20,class:"stats-grid"},{default:s(()=>[n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[2]||(a[2]=e("div",{class:"stat-label"},"行业名称",-1)),e("div",G,r(t.value.industry),1)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[3]||(a[3]=e("div",{class:"stat-label"},"股票总数",-1)),e("div",J,r(t.value.count)+"只",1)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[4]||(a[4]=e("div",{class:"stat-label"},"市场占比",-1)),e("div",K,r(P(t.value.count||0))+"%",1)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[5]||(a[5]=e("div",{class:"stat-label"},"平均涨跌幅",-1)),e("div",{class:C(["stat-value",{positive:t.value.avgChangePercent&&t.value.avgChangePercent>0,negative:t.value.avgChangePercent&&t.value.avgChangePercent<0,neutral:t.value.avgChangePercent===0}])},r(p(t.value.avgChangePercent||0)),3)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[6]||(a[6]=e("div",{class:"stat-label"},"平均PE",-1)),e("div",Q,r(t.value.avgPeRatio?t.value.avgPeRatio.toFixed(2):"N/A"),1)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[7]||(a[7]=e("div",{class:"stat-label"},"平均PB",-1)),e("div",W,r(t.value.avgPbRatio?t.value.avgPbRatio.toFixed(2):"N/A"),1)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[8]||(a[8]=e("div",{class:"stat-label"},"60天涨跌幅",-1)),e("div",{class:C(["stat-value",{positive:t.value.avgChange60Day&&t.value.avgChange60Day>0,negative:t.value.avgChange60Day&&t.value.avgChange60Day<0,neutral:t.value.avgChange60Day===0}])},r(p(t.value.avgChange60Day||0)),3)]),_:1})]),_:1}),n(c,{xs:12,sm:6,md:6,lg:6},{default:s(()=>[n(i,{class:"stat-card",shadow:"hover"},{default:s(()=>[a[9]||(a[9]=e("div",{class:"stat-label"},"年初至今涨跌幅",-1)),e("div",{class:C(["stat-value",{positive:t.value.avgChangeYtd&&t.value.avgChangeYtd>0,negative:t.value.avgChangeYtd&&t.value.avgChangeYtd<0,neutral:t.value.avgChangeYtd===0}])},r(p(t.value.avgChangeYtd||0)),3)]),_:1})]),_:1})]),_:1})]),e("div",X,[e("div",Z,[a[10]||(a[10]=e("h2",null,"股票列表",-1)),e("div",tt,"共 "+r(t.value.stocks?.length||0)+" 只股票",1)]),e("div",et,[n(S,{data:g.value,style:{width:"100%"},stripe:"",border:"",loading:h.value,"empty-text":"暂无股票数据"},{default:s(()=>[n(f,{prop:"code",label:"股票代码","min-width":"100",sortable:""},{default:s(o=>[e("a",{href:`https://xueqiu.com/S/SH${o.row.code}`,target:"_blank",class:"stock-code stock-link"},r(o.row.code),9,at)]),_:1}),n(f,{prop:"name",label:"股票名称","min-width":"120",sortable:""},{default:s(o=>[e("span",st,r(o.row.name),1)]),_:1}),n(f,{prop:"total_market_cap",label:"总市值","min-width":"100",align:"center",sortable:""},{default:s(o=>[e("span",nt,r(o.row.total_market_cap?.toFixed(2)),1)]),_:1}),n(f,{prop:"latest_price",label:"最新价格","min-width":"80",align:"center",sortable:""},{default:s(o=>[e("span",ot,r(o.row.latest_price?.toFixed(2)||"N/A"),1)]),_:1}),n(f,{prop:"change_percent",label:"涨跌幅","min-width":"80",align:"center",sortable:""},{default:s(o=>[e("span",{class:C(["change-value",{positive:o.row.change_percent>0,negative:o.row.change_percent<0,neutral:o.row.change_percent===0}])},r(p(o.row.change_percent)),3)]),_:1}),n(f,{prop:"pe_ratio",label:"市盈率","min-width":"70",align:"center",sortable:""},{default:s(o=>[e("span",lt,r(o.row.pe_ratio?.toFixed(2)||"N/A"),1)]),_:1}),n(f,{prop:"pb_ratio",label:"市净率","min-width":"70",align:"center",sortable:""},{default:s(o=>[e("span",rt,r(o.row.pb_ratio?.toFixed(2)||"N/A"),1)]),_:1}),n(f,{prop:"change_60day",label:"60天涨跌","min-width":"80",align:"center",sortable:""},{default:s(o=>[e("span",{class:C(["change-value",{positive:o.row.change_60day>0,negative:o.row.change_60day<0,neutral:o.row.change_60day===0}])},r(p(o.row.change_60day)),3)]),_:1}),n(f,{prop:"change_ytd",label:"年初至今","min-width":"80",align:"center",sortable:""},{default:s(o=>[e("span",{class:C(["change-value",{positive:o.row.change_ytd>0,negative:o.row.change_ytd<0,neutral:o.row.change_ytd===0}])},r(p(o.row.change_ytd)),3)]),_:1})]),_:1},8,["data","loading"])])])])):(I(),R("div",it,[a[11]||(a[11]=e("div",{class:"error-message"},"未找到行业数据",-1)),e("button",{class:"retry-button",onClick:b},"返回行业分析")]))])}}}),ut=z(ct,[["__scopeId","data-v-ab3ec410"]]);export{ut as default};
