import{d as A,r as z,a as v,B as G,C as H,j as J,c as m,b as n,g as V,e as l,w as s,i as u,E as f,F as b,A as w,k as B,t as D,P as K,u as Q,o as r,f as y,_ as W}from"./index-Cl72p8Gf.js";import{g as X,c as Z,r as ee}from"./quantBacktestApi-D4gvRime.js";import{a as te}from"./stockHistoryApi-iPk6qoJz.js";const ae={class:"backtest-strategy-view"},le={class:"strategy-config-panel"},se={key:0,class:"strategy-params"},oe={key:0,class:"strategy-description"},re={class:"description-content"},ne={key:0,class:"params-info"},ue=A({__name:"BacktestStrategyView",setup(de){Q();const F=J(),e=z({strategyName:"",symbol:"",startDate:"",endDate:"",initialCash:1e5,strategyParams:{}}),k=v([]),C=v([]),c=v(null),h=v(!1),S=G(()=>!!e.strategyName&&!!e.symbol&&!!e.startDate&&!!e.endDate),U=o=>{const t=k.value.find(d=>d.name===o);t&&(c.value=t,e.strategyParams={},t.params&&Object.keys(t.params).forEach(d=>{e.strategyParams[d]=t.params[d].default}))},L=async()=>{if(!S.value){f.warning("请填写完整的回测配置");return}h.value=!0;try{const o={strategy_name:e.strategyName,stock_code:e.symbol,start_date:e.startDate,end_date:e.endDate,initial_cash:e.initialCash,strategy_params:e.strategyParams},t=await Z(o);f.success("回测任务创建成功"),K.confirm("回测任务已创建，是否立即运行？","提示",{confirmButtonText:"立即运行",cancelButtonText:"稍后运行",type:"info"}).then(async()=>{await q(t.task_id)}).catch(()=>{})}catch(o){console.error("创建回测任务失败:",o),f.error("创建回测任务失败")}finally{h.value=!1}},q=async o=>{try{await ee(o),f.success("回测任务已启动")}catch(t){console.error("运行回测任务失败:",t),f.error("运行回测任务失败")}},E=()=>{e.strategyName="",e.symbol="",e.startDate="",e.endDate="",e.initialCash=1e5,e.strategyParams={},c.value=null},I=async()=>{try{const o=await X();k.value=o}catch(o){console.error("加载策略列表失败:",o),f.error("加载策略列表失败")}},O=async()=>{try{const{data:o}=await te(1,100);C.value=o}catch(o){console.error("加载股票列表失败:",o),f.error("加载股票列表失败")}};return H(async()=>{await Promise.all([I(),O()]);const o=new Date,t=new Date;t.setFullYear(o.getFullYear()-1),e.endDate=o.toISOString().split("T")[0],e.startDate=t.toISOString().split("T")[0];const d=F.query.strategy;d&&(e.strategyName=d,U(d))}),(o,t)=>{const d=u("el-option"),M=u("el-select"),p=u("el-form-item"),g=u("el-col"),Y=u("el-row"),N=u("el-date-picker"),P=u("el-input-number"),j=u("el-input"),R=u("el-switch"),x=u("el-button"),$=u("el-form"),T=u("el-card");return r(),m("div",ae,[t[11]||(t[11]=n("div",{class:"page-header"},[n("h1",null,"创建回测策略"),n("p",null,"选择策略并配置参数，创建回测任务")],-1)),n("div",le,[l(T,null,{header:s(()=>[...t[5]||(t[5]=[n("div",{class:"card-header"},[n("span",null,"策略配置")],-1)])]),default:s(()=>[l($,{model:e,"label-width":"120px",class:"strategy-form"},{default:s(()=>[l(Y,{gutter:20},{default:s(()=>[l(g,{span:12},{default:s(()=>[l(p,{label:"选择策略",required:""},{default:s(()=>[l(M,{modelValue:e.strategyName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.strategyName=a),placeholder:"请选择策略",class:"full-width",onChange:U},{default:s(()=>[(r(!0),m(b,null,w(k.value,a=>(r(),y(d,{key:a.name,label:a.description,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,{span:12},{default:s(()=>[l(p,{label:"股票代码",required:""},{default:s(()=>[l(M,{modelValue:e.symbol,"onUpdate:modelValue":t[1]||(t[1]=a=>e.symbol=a),placeholder:"请选择股票",class:"full-width",filterable:""},{default:s(()=>[(r(!0),m(b,null,w(C.value,a=>(r(),y(d,{key:a.code,label:`${a.code} ${a.name}`,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Y,{gutter:20},{default:s(()=>[l(g,{span:8},{default:s(()=>[l(p,{label:"开始日期",required:""},{default:s(()=>[l(N,{modelValue:e.startDate,"onUpdate:modelValue":t[2]||(t[2]=a=>e.startDate=a),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:s(()=>[l(p,{label:"结束日期",required:""},{default:s(()=>[l(N,{modelValue:e.endDate,"onUpdate:modelValue":t[3]||(t[3]=a=>e.endDate=a),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:s(()=>[l(p,{label:"初始资金"},{default:s(()=>[l(P,{modelValue:e.initialCash,"onUpdate:modelValue":t[4]||(t[4]=a=>e.initialCash=a),min:1e4,step:1e4,precision:0,class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),c.value&&c.value.params?(r(),m("div",se,[t[6]||(t[6]=n("h3",null,"策略参数",-1)),l(Y,{gutter:20},{default:s(()=>[(r(!0),m(b,null,w(c.value.params,(a,i)=>(r(),y(g,{span:8,key:i},{default:s(()=>[l(p,{label:a.description},{default:s(()=>[a.type==="int"?(r(),y(P,{key:0,modelValue:e.strategyParams[i],"onUpdate:modelValue":_=>e.strategyParams[i]=_,min:1,precision:0,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="string"?(r(),y(j,{key:1,modelValue:e.strategyParams[i],"onUpdate:modelValue":_=>e.strategyParams[i]=_,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="float"?(r(),y(P,{key:2,modelValue:e.strategyParams[i],"onUpdate:modelValue":_=>e.strategyParams[i]=_,precision:2,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="boolean"?(r(),y(R,{key:3,modelValue:e.strategyParams[i],"onUpdate:modelValue":_=>e.strategyParams[i]=_},null,8,["modelValue","onUpdate:modelValue"])):V("",!0)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})])):V("",!0),l(p,null,{default:s(()=>[l(x,{type:"primary",onClick:L,loading:h.value,disabled:!S.value},{default:s(()=>[...t[7]||(t[7]=[B(" 创建回测任务 ",-1)])]),_:1},8,["loading","disabled"]),l(x,{onClick:E},{default:s(()=>[...t[8]||(t[8]=[B("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),c.value?(r(),m("div",oe,[l(T,null,{header:s(()=>[...t[9]||(t[9]=[n("div",{class:"card-header"},[n("span",null,"策略说明")],-1)])]),default:s(()=>[n("div",re,[n("h3",null,D(c.value.description),1),c.value.params?(r(),m("div",ne,[t[10]||(t[10]=n("h4",null,"参数说明：",-1)),n("ul",null,[(r(!0),m(b,null,w(c.value.params,(a,i)=>(r(),m("li",{key:i},[n("strong",null,D(a.description),1),B(": "+D(a.type)+"类型，默认值: "+D(a.default),1)]))),128))])])):V("",!0)])]),_:1})])):V("",!0)])}}}),pe=W(ue,[["__scopeId","data-v-e2288813"]]);export{pe as default};
