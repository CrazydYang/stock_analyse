import{x as u}from"./index-COoaZqH2.js";const l="/django/api/stock";async function f(r,n){try{const e={},a=await u.get(`${l}/industry-sectors/`,{params:e});if(a.code!==200)throw new Error(a.message||"获取行业板块列表失败");const s=[];for(const t of a.data.sectors)s.push({industry:t.name,code:t.code,count:t.stock_count,stocks:[],latest_price:t.latest_price,change_amount:t.change_amount,change_percent:t.change_percent,total_market_value:t.total_market_value,turnover_rate:t.turnover_rate,rise_count:t.rise_count,fall_count:t.fall_count,leading_stock:t.leading_stock,leading_stock_change_percent:t.leading_stock_change_percent,description:t.description,created_at:t.created_at,updated_at:t.updated_at});return s}catch(e){throw console.error("获取行业板块列表错误:",e),e}}async function y(r){try{const n=await u.get(`${l}/industry-sector/constituents/${r}/`);if(n.code!==200)throw new Error(n.message||"获取行业成分股失败");const e=n.data.constituents,a=h(e);return{stocks:e,stats:a}}catch(n){throw console.error(`获取行业板块 ${r} 成分股失败:`,n),n}}function h(r){if(!r||r.length===0)return{avgChangePercent:0,avgPeRatio:0,avgPbRatio:0,avgChange60Day:0,avgChangeYtd:0};let n=0,e=0,a=0,s=0,t=0,i=0,c=0,g=0,_=0,d=0;return r.forEach(o=>{typeof o.change_percent=="number"&&(n+=o.change_percent,i++),typeof o.pe_ratio=="number"&&o.pe_ratio>0&&(e+=o.pe_ratio,c++),typeof o.pb_ratio=="number"&&o.pb_ratio>0&&(a+=o.pb_ratio,g++),typeof o.change_60day=="number"&&(s+=o.change_60day,_++),typeof o.change_ytd=="number"&&(t+=o.change_ytd,d++)}),{avgChangePercent:i>0?n/i:0,avgPeRatio:c>0?e/c:0,avgPbRatio:g>0?a/g:0,avgChange60Day:_>0?s/_:0,avgChangeYtd:d>0?t/d:0}}async function m(r){try{const n=await u.get(`${l}/industry-sectors/`);if(n.code!==200)throw new Error(n.message||"获取行业板块列表失败");const e=n.data.sectors.find(c=>c.name===r);if(!e)return console.warn(`未找到行业: ${r}`),null;const a=await u.get(`${l}/industry-sector/constituents/${e.code}/`);if(a.code!==200)throw new Error(a.message||"获取行业成分股失败");const s=a.data.constituents;let t=null;try{const c=await u.get(`${l}/industry-sector/realtime/${e.code}/`);c.code===200&&(t=c.data)}catch(c){console.warn(`获取行业 ${e.code} 实时行情失败:`,c)}const i=h(s);return{industry:e.name,code:e.code,count:e.stock_count,stocks:s,...i,latest_price:t?.latest_price||e.latest_price,change_amount:t?.change,change_percent:t?.change_percent||e.change_percent,open:t?.open,high:t?.high,low:t?.low,volume:t?.volume,amount:t?.amount,turnover_rate:t?.turnover_rate,rising_stocks:t?.rising_stocks,falling_stocks:t?.falling_stocks,unchanged_stocks:t?.unchanged_stocks}}catch(n){throw console.error("获取行业详情错误:",n),n}}export{y as a,m as b,f};
