import{d as pe,a as d,r as M,j as _e,z as G,D as me,y as fe,a5 as ge,c as x,e as o,w as s,i as u,E as B,L as K,b as p,g as O,F as he,A as ve,f as ye,l as L,I as xe,k as h,J as we,t as w,C as be,P as ke,K as Ce,u as Se,o as v,_ as De}from"./index-BgrsVbnu.js";import{i as T}from"./index-1yOyFXf9.js";import{c as Ie,d as Le,g as Ae}from"./individualStockApi-C2WVpK4h.js";const ze={class:"stock-history-view"},Re={class:"header-content"},Fe={class:"stock-info"},Ve={class:"stock-code"},Ee={key:0},Pe={class:"header-actions"},Be={class:"query-section"},Oe={key:0,class:"chart-container"},Ye={key:1,class:"chart-container"},Ne={key:2,class:"table-container"},$e={class:"pagination-container"},He={key:3,class:"loading-container"},Me={key:4,class:"empty-container"},Ge=pe({__name:"StockHistoryView",setup(Ke){const Y=_e(),N=Se(),A=d(null),z=d(null);let _=null,m=null;const C=d(!1),R=d(!1),F=d(!1),g=M({code:"",name:"",industry:"",total_shares:0,circulating_shares:0,list_date:"",pe_ratio:0,pb_ratio:0,total_market_cap:0,circulating_market_cap:0,created_at:"",updated_at:"",latest_price:0,change_percent:0,change_amount:0,volume:0,amount:0,amplitude:0,high:0,low:0,open_price:0,close_price:0,volume_ratio:0,turnover_rate:0,price_change_speed:0,change_5min:0,change_60d:0,change_ytd:0}),l=M({code:Y.params.code||"",dateRange:[]}),i=d([]),b=d([]),$=d([]),V=d("date"),E=d("desc"),k=d(1),D=d(20),U=G(()=>i.value.length?[...i.value].sort((e,t)=>{const a=e[V.value],r=t[V.value];if(typeof a=="string"&&typeof r=="string")return E.value==="asc"?a.localeCompare(r):r.localeCompare(a);{const S=a==null?-1/0:Number(a),y=r==null?-1/0:Number(r);return E.value==="asc"?S-y:y-S}}):[]),j=G(()=>{const e=(k.value-1)*D.value,t=e+D.value;return U.value.slice(e,t)}),Z=()=>{N.back()},I=async()=>{if(!l.code){B.warning("请选择股票");return}C.value=!0;try{const e=l.dateRange[0]||"",t=l.dateRange[1]||"",a=await Ie(l.code,{start_date:e,end_date:t,adjust:""});if(i.value=a,a&&a.length>0){const r=a[0];g.code=l.code,g.name=r.stock_name||""}await J(),B.success("历史行情数据加载成功")}catch(e){console.error("获取历史行情数据失败:",e),B.error("获取历史行情数据失败，请稍后重试")}finally{C.value=!1,i.value&&i.value.length>0?(await K(),Q()):_&&_.clear(),b.value&&b.value.length>0?(await K(),q()):m&&m.clear()}},J=async()=>{if(l.code){F.value=!0;try{const e=await Le(l.code,{page:1,page_size:20});b.value=e.reports.sort((t,a)=>a.report_date.localeCompare(t.report_date)),console.log("业绩数据加载成功:",b.value.length,"条记录")}catch(e){console.error("获取业绩数据失败:",e)}finally{F.value=!1}}},Q=()=>{if(!A.value)return;_&&_.dispose(),_=T(A.value),i.value.map(t=>[t.date,t.open_price,t.close_price,t.low_price,t.high_price,t.volume]);const e={title:{text:`${g.name} (${g.code}) 历史K线图`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["K线","成交量"],bottom:10},grid:[{id:"main",left:"10%",right:"10%",height:"60%",top:"10%"},{id:"volume",left:"10%",right:"10%",top:"75%",height:"15%"}],xAxis:[{type:"category",data:i.value.map(t=>t.date),scale:!0,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},splitNumber:20,gridIndex:0},{type:"category",data:i.value.map(t=>t.date),scale:!0,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},gridIndex:1,axisLabel:{show:!1}}],yAxis:[{type:"value",scale:!0,splitLine:{show:!0},position:"right",name:"价格",nameLocation:"middle",nameGap:30,gridIndex:0},{type:"value",scale:!0,splitLine:{show:!1},name:"成交量",nameLocation:"middle",nameGap:15,gridIndex:1}],dataZoom:[{type:"inside",start:0,end:100,xAxisIndex:[0,1]},{show:!0,type:"slider",bottom:5,start:0,end:100,xAxisIndex:[0,1]}],series:[{name:"K线",type:"candlestick",xAxisIndex:0,yAxisIndex:0,data:i.value.map(t=>[t.open_price,t.close_price,t.low_price,t.high_price]),itemStyle:{color:"#f56c6c",color0:"#67c23a",borderColor:"#f56c6c",borderColor0:"#67c23a"}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:i.value.map(t=>t.volume),itemStyle:{color:function(t){const a=t.dataIndex,r=i.value[a];return r.close_price>r.open_price?"#f56c6c":"#67c23a"}}}]};_.setOption(e),window.addEventListener("resize",()=>{_?.resize()})},q=()=>{if(!z.value||!b.value.length)return;m&&m.dispose(),m=T(z.value);const e=[...b.value].sort((c,f)=>c.report_date.localeCompare(f.report_date)),t=e.map(c=>c.report_date),a=e.map(c=>c.operating_revenue/1e8),r=e.map(c=>c.net_profit/1e8),S=e.map(c=>c.earnings_per_share),y=e.map(c=>c.roe),P={title:{text:`${g.name} (${g.code}) 业绩数据趋势`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["营业收入(亿元)","净利润(亿元)","每股收益(元)","ROE(%)"],bottom:10},grid:{left:"10%",right:"10%",top:"15%",bottom:"15%"},xAxis:{type:"category",data:t,axisLabel:{rotate:45}},yAxis:[{type:"value",name:"金额(亿元)",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"比率",position:"right",axisLabel:{formatter:"{value}"}}],series:[{name:"营业收入(亿元)",type:"line",yAxisIndex:0,data:a,smooth:!0,itemStyle:{color:"#409EFF"}},{name:"净利润(亿元)",type:"line",yAxisIndex:0,data:r,smooth:!0,itemStyle:{color:"#67C23A"}},{name:"每股收益(元)",type:"line",yAxisIndex:1,data:S,smooth:!0,itemStyle:{color:"#E6A23C"}},{name:"ROE(%)",type:"line",yAxisIndex:1,data:y,smooth:!0,itemStyle:{color:"#F56C6C"}}]};m.setOption(P),window.addEventListener("resize",()=>{m?.resize()})},W=async e=>{if(!(e.length<2)){R.value=!0;try{const a=(await Ae()).data;$.value=a.filter(r=>r.code.includes(e)||r.name.includes(e)).slice(0,20)}catch(t){console.error("搜索股票失败:",t)}finally{R.value=!1}}},X=e=>{l.code=e,N.push(`/stock-history/${e}`)},H=()=>{k.value=1,I()},ee=()=>{l.dateRange=[],k.value=1},te=({prop:e,order:t})=>{V.value=e||"date",E.value=t==="ascending"?"asc":"desc"},ae=e=>{D.value=e,k.value=1},oe=e=>{k.value=e},ne=e=>e>0?"price-up":e<0?"price-down":"price-unchanged",re=e=>e==null?"-":e>=1e8?(e/1e8).toFixed(2)+"亿手":e>=1e4?(e/1e4).toFixed(2)+"万手":e.toString()+"手",se=e=>e==null?"-":e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toString();return me(()=>Y.params.code,e=>{e&&typeof e=="string"&&(l.code=e,I())}),fe(()=>{const e=new Date,t=new Date;t.setDate(t.getDate()-30),l.dateRange=[t.toISOString().split("T")[0].replace(/-/g,""),e.toISOString().split("T")[0].replace(/-/g,"")],l.code&&I()}),ge(()=>{_&&(_.dispose(),_=null),m&&(m.dispose(),m=null),window.removeEventListener("resize",()=>{_?.resize()}),window.removeEventListener("resize",()=>{m?.resize()})}),(e,t)=>{const a=u("el-button"),r=u("el-option"),S=u("el-select"),y=u("el-form-item"),P=u("el-date-picker"),c=u("el-form"),f=u("el-table-column"),le=u("el-table"),ie=u("el-pagination"),ce=u("el-skeleton"),de=u("el-empty"),ue=u("el-card");return v(),x("div",ze,[o(ue,{class:"page-header"},{header:s(()=>[p("div",Re,[p("div",Fe,[p("h2",null,[h(w(g.name)+" ",1),p("span",Ve,w(g.code),1)]),g.industry?(v(),x("p",Ee,w(g.industry),1)):O("",!0)]),p("div",Pe,[o(a,{type:"primary",icon:L(ke),onClick:Z},{default:s(()=>[...t[3]||(t[3]=[h("返回",-1)])]),_:1},8,["icon"]),o(a,{type:"success",icon:L(Ce),onClick:I,loading:C.value},{default:s(()=>[...t[4]||(t[4]=[h(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),default:s(()=>[p("div",Be,[o(c,{inline:!0,model:l},{default:s(()=>[o(y,{label:"股票代码"},{default:s(()=>[o(S,{modelValue:l.code,"onUpdate:modelValue":t[0]||(t[0]=n=>l.code=n),filterable:"",remote:"",placeholder:"请输入股票代码或名称","remote-method":W,loading:R.value,onChange:X},{default:s(()=>[(v(!0),x(he,null,ve($.value,n=>(v(),ye(r,{key:n.code,label:`${n.name} (${n.code})`,value:n.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),o(y,{label:"日期范围"},{default:s(()=>[o(P,{modelValue:l.dateRange,"onUpdate:modelValue":t[1]||(t[1]=n=>l.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYYMMDD"},null,8,["modelValue"])]),_:1}),o(y,null,{default:s(()=>[o(a,{type:"primary",icon:L(xe),onClick:H},{default:s(()=>[...t[5]||(t[5]=[h("查询",-1)])]),_:1},8,["icon"]),o(a,{icon:L(we),onClick:ee},{default:s(()=>[...t[6]||(t[6]=[h("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),!C.value&&i.value.length>0?(v(),x("div",Oe,[p("div",{ref_key:"chartRef",ref:A,class:"stock-chart"},null,512)])):O("",!0),!F.value&&b.value.length>0?(v(),x("div",Ye,[t[7]||(t[7]=p("h3",null,"业绩数据趋势",-1)),p("div",{ref_key:"performanceChartRef",ref:z,class:"performance-chart"},null,512)])):O("",!0),!C.value&&i.value.length>0?(v(),x("div",Ne,[t[8]||(t[8]=p("h3",null,"历史行情数据",-1)),o(le,{data:j.value,border:"",stripe:"",style:{width:"100%","max-width":"100%"},height:"400",onSortChange:te},{default:s(()=>[o(f,{prop:"date",label:"日期",width:"120",sortable:""}),o(f,{prop:"open_price",label:"开盘价","min-width":"100",sortable:""}),o(f,{prop:"high_price",label:"最高价","min-width":"100",sortable:""}),o(f,{prop:"low_price",label:"最低价","min-width":"100",sortable:""}),o(f,{prop:"close_price",label:"收盘价","min-width":"100",sortable:""}),o(f,{prop:"change_percent",label:"涨跌幅","min-width":"100",sortable:""},{default:s(n=>[p("span",{class:be(ne(n.row.change_percent))},w(n.row.change_percent>0?"+":"")+w(n.row.change_percent.toFixed(2))+"% ",3)]),_:1}),o(f,{prop:"volume",label:"成交量","min-width":"120",sortable:""},{default:s(n=>[h(w(re(n.row.volume)),1)]),_:1}),o(f,{prop:"amount",label:"成交额","min-width":"120",sortable:""},{default:s(n=>[h(w(se(n.row.amount)),1)]),_:1}),o(f,{prop:"turnover_rate",label:"换手率","min-width":"100",sortable:""},{default:s(n=>[h(w(n.row.turnover_rate?n.row.turnover_rate.toFixed(2)+"%":"-"),1)]),_:1})]),_:1},8,["data"]),p("div",$e,[o(ie,{"current-page":k.value,"onUpdate:currentPage":t[2]||(t[2]=n=>k.value=n),"page-size":D.value,total:i.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:oe},null,8,["current-page","page-size","total"])])])):C.value?(v(),x("div",He,[o(ce,{rows:10,animated:""})])):(v(),x("div",Me,[o(de,{description:"暂无历史行情数据"},{default:s(()=>[o(a,{type:"primary",onClick:H},{default:s(()=>[...t[9]||(t[9]=[h("查询数据",-1)])]),_:1})]),_:1})]))]),_:1})])}}}),Ze=De(Ge,[["__scopeId","data-v-4f3f11a7"]]);export{Ze as default};
