import{d as ne,a as _,r as N,j as re,H as Y,I as se,y as le,a4 as ie,c as y,e as a,w as r,i as c,E as z,O as ce,b as u,g as H,F as de,D as ue,f as pe,l as S,L as _e,k as m,M as me,t as g,G as fe,U as ge,N as he,u as ve,o as h,_ as ye}from"./index-B66z1j89.js";import{i as be}from"./index-1yOyFXf9.js";import{c as we,g as xe}from"./individualStockApi-zYriQsjd.js";const ke={class:"stock-history-view"},Ce={class:"header-content"},Se={class:"stock-info"},De={class:"stock-code"},Ie={key:0},Le={class:"header-actions"},Ve={class:"query-section"},ze={key:0,class:"chart-container"},Ae={key:1,class:"table-container"},Re={class:"pagination-container"},Fe={key:2,class:"loading-container"},Be={key:3,class:"empty-container"},Ne=ne({__name:"StockHistoryView",setup(Ye){const A=re(),R=ve(),D=_(null);let d=null;const b=_(!1),I=_(!1),f=N({code:"",name:"",industry:"",total_shares:0,circulating_shares:0,list_date:"",pe_ratio:0,pb_ratio:0,total_market_cap:0,circulating_market_cap:0,created_at:"",updated_at:"",latest_price:0,change_percent:0,change_amount:0,volume:0,amount:0,amplitude:0,high:0,low:0,open_price:0,close_price:0,volume_ratio:0,turnover_rate:0,price_change_speed:0,change_5min:0,change_60d:0,change_ytd:0}),l=N({code:A.params.code||"",dateRange:[]}),i=_([]),F=_([]),L=_("date"),V=_("desc"),v=_(1),x=_(20),M=Y(()=>i.value.length?[...i.value].sort((t,e)=>{const o=t[L.value],s=e[L.value];if(typeof o=="string"&&typeof s=="string")return V.value==="asc"?o.localeCompare(s):s.localeCompare(o);{const C=o==null?-1/0:Number(o),w=s==null?-1/0:Number(s);return V.value==="asc"?C-w:w-C}}):[]),O=Y(()=>{const t=(v.value-1)*x.value,e=t+x.value;return M.value.slice(t,e)}),E=()=>{R.back()},k=async()=>{if(!l.code){z.warning("请选择股票");return}b.value=!0;try{const t=l.dateRange[0]||"",e=l.dateRange[1]||"",o=await we(l.code,{start_date:t,end_date:e,adjust:""});if(i.value=o,o&&o.length>0){const s=o[0];f.code=l.code,f.name=s.stock_name||""}z.success("历史行情数据加载成功")}catch(t){console.error("获取历史行情数据失败:",t),z.error("获取历史行情数据失败，请稍后重试")}finally{b.value=!1,i.value&&i.value.length>0?(await ce(),G()):d&&d.clear()}},G=()=>{if(!D.value)return;d&&d.dispose(),d=be(D.value),i.value.map(e=>[e.date,e.open_price,e.close_price,e.low_price,e.high_price,e.volume]);const t={title:{text:`${f.name} (${f.code}) 历史K线图`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["K线","成交量"],bottom:10},grid:[{id:"main",left:"10%",right:"10%",height:"60%",top:"10%"},{id:"volume",left:"10%",right:"10%",top:"75%",height:"15%"}],xAxis:[{type:"category",data:i.value.map(e=>e.date),scale:!0,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},splitNumber:20,gridIndex:0},{type:"category",data:i.value.map(e=>e.date),scale:!0,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},gridIndex:1,axisLabel:{show:!1}}],yAxis:[{type:"value",scale:!0,splitLine:{show:!0},position:"right",name:"价格",nameLocation:"middle",nameGap:30,gridIndex:0},{type:"value",scale:!0,splitLine:{show:!1},name:"成交量",nameLocation:"middle",nameGap:15,gridIndex:1}],dataZoom:[{type:"inside",start:0,end:100,xAxisIndex:[0,1]},{show:!0,type:"slider",bottom:5,start:0,end:100,xAxisIndex:[0,1]}],series:[{name:"K线",type:"candlestick",xAxisIndex:0,yAxisIndex:0,data:i.value.map(e=>[e.open_price,e.close_price,e.low_price,e.high_price]),itemStyle:{color:"#f56c6c",color0:"#67c23a",borderColor:"#f56c6c",borderColor0:"#67c23a"}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:i.value.map(e=>e.volume),itemStyle:{color:function(e){const o=e.dataIndex,s=i.value[o];return s.close_price>s.open_price?"#f56c6c":"#67c23a"}}}]};d.setOption(t),window.addEventListener("resize",()=>{d?.resize()})},U=async t=>{if(!(t.length<2)){I.value=!0;try{const o=(await xe()).data;F.value=o.filter(s=>s.code.includes(t)||s.name.includes(t)).slice(0,20)}catch(e){console.error("搜索股票失败:",e)}finally{I.value=!1}}},$=t=>{l.code=t,R.push(`/stock-history/${t}`)},B=()=>{v.value=1,k()},P=()=>{l.dateRange=[],v.value=1},T=({prop:t,order:e})=>{L.value=t||"date",V.value=e==="ascending"?"asc":"desc"},j=t=>{x.value=t,v.value=1},K=t=>{v.value=t},Z=t=>t>0?"price-up":t<0?"price-down":"price-unchanged",Q=t=>t==null?"-":t>=1e8?(t/1e8).toFixed(2)+"亿手":t>=1e4?(t/1e4).toFixed(2)+"万手":t.toString()+"手",q=t=>t==null?"-":t>=1e8?(t/1e8).toFixed(2)+"亿":t>=1e4?(t/1e4).toFixed(2)+"万":t.toString();return se(()=>A.params.code,t=>{t&&typeof t=="string"&&(l.code=t,k())}),le(()=>{const t=new Date,e=new Date;e.setDate(e.getDate()-30),l.dateRange=[e.toISOString().split("T")[0].replace(/-/g,""),t.toISOString().split("T")[0].replace(/-/g,"")],l.code&&k()}),ie(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",()=>{d?.resize()})}),(t,e)=>{const o=c("el-button"),s=c("el-option"),C=c("el-select"),w=c("el-form-item"),J=c("el-date-picker"),W=c("el-form"),p=c("el-table-column"),X=c("el-table"),ee=c("el-pagination"),te=c("el-skeleton"),ae=c("el-empty"),oe=c("el-card");return h(),y("div",ke,[a(oe,{class:"page-header"},{header:r(()=>[u("div",Ce,[u("div",Se,[u("h2",null,[m(g(f.name)+" ",1),u("span",De,g(f.code),1)]),f.industry?(h(),y("p",Ie,g(f.industry),1)):H("",!0)]),u("div",Le,[a(o,{type:"primary",icon:S(ge),onClick:E},{default:r(()=>[...e[3]||(e[3]=[m("返回",-1)])]),_:1},8,["icon"]),a(o,{type:"success",icon:S(he),onClick:k,loading:b.value},{default:r(()=>[...e[4]||(e[4]=[m(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),default:r(()=>[u("div",Ve,[a(W,{inline:!0,model:l},{default:r(()=>[a(w,{label:"股票代码"},{default:r(()=>[a(C,{modelValue:l.code,"onUpdate:modelValue":e[0]||(e[0]=n=>l.code=n),filterable:"",remote:"",placeholder:"请输入股票代码或名称","remote-method":U,loading:I.value,onChange:$},{default:r(()=>[(h(!0),y(de,null,ue(F.value,n=>(h(),pe(s,{key:n.code,label:`${n.name} (${n.code})`,value:n.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(w,{label:"日期范围"},{default:r(()=>[a(J,{modelValue:l.dateRange,"onUpdate:modelValue":e[1]||(e[1]=n=>l.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYYMMDD"},null,8,["modelValue"])]),_:1}),a(w,null,{default:r(()=>[a(o,{type:"primary",icon:S(_e),onClick:B},{default:r(()=>[...e[5]||(e[5]=[m("查询",-1)])]),_:1},8,["icon"]),a(o,{icon:S(me),onClick:P},{default:r(()=>[...e[6]||(e[6]=[m("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),!b.value&&i.value.length>0?(h(),y("div",ze,[u("div",{ref_key:"chartRef",ref:D,class:"stock-chart"},null,512)])):H("",!0),!b.value&&i.value.length>0?(h(),y("div",Ae,[e[7]||(e[7]=u("h3",null,"历史行情数据",-1)),a(X,{data:O.value,border:"",stripe:"",style:{width:"100%","max-width":"100%"},height:"400",onSortChange:T},{default:r(()=>[a(p,{prop:"date",label:"日期",width:"120",sortable:""}),a(p,{prop:"open_price",label:"开盘价","min-width":"100",sortable:""}),a(p,{prop:"high_price",label:"最高价","min-width":"100",sortable:""}),a(p,{prop:"low_price",label:"最低价","min-width":"100",sortable:""}),a(p,{prop:"close_price",label:"收盘价","min-width":"100",sortable:""}),a(p,{prop:"change_percent",label:"涨跌幅","min-width":"100",sortable:""},{default:r(n=>[u("span",{class:fe(Z(n.row.change_percent))},g(n.row.change_percent>0?"+":"")+g(n.row.change_percent.toFixed(2))+"% ",3)]),_:1}),a(p,{prop:"volume",label:"成交量","min-width":"120",sortable:""},{default:r(n=>[m(g(Q(n.row.volume)),1)]),_:1}),a(p,{prop:"amount",label:"成交额","min-width":"120",sortable:""},{default:r(n=>[m(g(q(n.row.amount)),1)]),_:1}),a(p,{prop:"turnover_rate",label:"换手率","min-width":"100",sortable:""},{default:r(n=>[m(g(n.row.turnover_rate?n.row.turnover_rate.toFixed(2)+"%":"-"),1)]),_:1})]),_:1},8,["data"]),u("div",Re,[a(ee,{"current-page":v.value,"onUpdate:currentPage":e[2]||(e[2]=n=>v.value=n),"page-size":x.value,total:i.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:K},null,8,["current-page","page-size","total"])])])):b.value?(h(),y("div",Fe,[a(te,{rows:10,animated:""})])):(h(),y("div",Be,[a(ae,{description:"暂无历史行情数据"},{default:r(()=>[a(o,{type:"primary",onClick:B},{default:r(()=>[...e[8]||(e[8]=[m("查询数据",-1)])]),_:1})]),_:1})]))]),_:1})])}}}),Ee=ye(Ne,[["__scopeId","data-v-b9b653c9"]]);export{Ee as default};
