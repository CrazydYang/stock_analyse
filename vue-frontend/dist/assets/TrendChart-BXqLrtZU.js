import{d as P,a as F,H as U,I as Q,y as j,O as E,P as q,c as v,b as o,g as N,e as n,i as M,w as Y,t as x,F as I,D as A,k as z,Q as G,o as r,f as J,_ as W}from"./index-D4a2Bw9J.js";import{i as X}from"./index-1yOyFXf9.js";const K={class:"trend-chart-container"},ee={class:"chart-header"},te={class:"chart-controls"},ae={class:"control-group"},le={key:0,class:"control-group"},se={key:1,class:"control-group"},oe={class:"control-group"},ne={class:"control-group"},de={key:0,class:"stats-section"},re={class:"stats-grid"},ie={class:"stat-card"},ue={class:"stat-value"},ce={class:"stat-value"},ve={class:"stat-label"},me={class:"stat-value"},pe={class:"stat-label"},fe={class:"stat-value"},he={class:"stat-label"},ge=P({__name:"TrendChart",props:{title:{default:"趋势分析图表"},data:{},dateField:{default:"date"},yFields:{},defaultSelectedFields:{default:()=>[]},height:{default:"600px"}},setup(Z){G(s=>({"23cb6dc7":s.height}));const l=Z,S=F();let i=null;const d=F(""),g=F(""),C=F("line"),u=F([]),b=F("all"),O=U(()=>l.yFields),y=U(()=>{if(!l.data||l.data.length===0)return[];let s=[...l.data];return d.value&&g.value&&(s=s.filter(e=>{const a=e[l.dateField];return a>=d.value&&a<=g.value})),s.sort((e,a)=>{const c=new Date(e[l.dateField]),h=new Date(a[l.dateField]);return c.getTime()-h.getTime()}),s}),V=s=>l.yFields.find(a=>a.key===s)?.label||s,T=s=>{const e=y.value.map(m=>parseFloat(m[s])).filter(m=>!isNaN(m));if(e.length===0)return{min:"0",max:"0",avg:"0"};const a=Math.min(...e),c=Math.max(...e),h=e.reduce((m,t)=>m+t,0)/e.length;return{min:a.toFixed(2),max:c.toFixed(2),avg:h.toFixed(2)}},$=()=>{if(!l.data||l.data.length===0)return;const s=l.data.map(a=>a[l.dateField]).sort(),e=s[s.length-1];switch(g.value=e,b.value){case"week":d.value=_(e,7);break;case"month":d.value=_(e,30);break;case"threeMonths":d.value=_(e,90);break;case"sixMonths":d.value=_(e,180);break;case"year":d.value=_(e,365);break;case"threeYears":d.value=_(e,365*3);break;case"all":d.value=s[0];break}f()},_=(s,e)=>{const a=new Date(s);return a.setDate(a.getDate()-e),a.toISOString().split("T")[0]},R=()=>{if(S.value){if(i=X(S.value),l.data&&l.data.length>0){const s=l.data.map(e=>e[l.dateField]).sort();d.value=s[0],g.value=s[s.length-1]}l.defaultSelectedFields.length>0?u.value=[...l.defaultSelectedFields]:l.yFields.length>0&&(u.value=[l.yFields[0].key]),b.value="all",f()}},f=async()=>{if(!i||u.value.length===0)return;await E();const s=y.value.map(t=>t[l.dateField]),e=["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96","#fa8c16","#a0d911","#2f54eb"],a=u.value.map((t,p)=>{const k=l.yFields.find(L=>L.key===t),w=y.value.map(L=>parseFloat(L[t])||0),D={name:k?.label||t,type:C.value==="area"?"line":C.value,data:w,yAxisIndex:k?.yAxisIndex||0,itemStyle:{color:k?.color||e[p%e.length]},emphasis:{focus:"series"}};return C.value==="area"&&(D.areaStyle={opacity:.3}),D}),c=[],h=new Set(u.value.map(t=>l.yFields.find(k=>k.key===t)?.yAxisIndex||0));Array.from(h).forEach((t,p)=>{c.push({type:"value",name:p===0?"主轴":`副轴${p}`,position:p===0?"left":"right",axisLine:{lineStyle:{color:e[p%e.length]}}})});const m={title:{subtext:`数据范围: ${d.value} 至 ${g.value} (共${y.value.length}条记录)`,left:"center"},tooltip:{trigger:"axis",formatter:function(t){const p=t[0].dataIndex;let w=`日期: ${y.value[p][l.dateField]}<br/>`;return t.forEach(D=>{w+=`${D.seriesName}: ${D.value}<br/>`}),w}},legend:{data:u.value.map(t=>V(t)),top:40},grid:{left:"3%",right:c.length>1?"8%":"4%",bottom:"15%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],xAxis:{type:"category",data:s,axisLabel:{rotate:45}},yAxis:c,series:a};i.setOption(m,!0)},H=()=>{i&&i.dispatchAction({type:"dataZoom",start:0,end:100})},B=()=>{i&&i.resize()};return Q(()=>l.data,()=>{i&&l.data&&l.data.length>0&&(b.value!=="custom"?$():f())},{deep:!0}),j(()=>{E(()=>{R(),window.addEventListener("resize",B)})}),q(()=>{i&&(i.dispose(),i=null),window.removeEventListener("resize",B)}),(s,e)=>{const a=M("el-option"),c=M("el-select"),h=M("el-date-picker"),m=M("el-button");return r(),v("div",K,[o("div",ee,[o("div",te,[o("div",ae,[e[5]||(e[5]=o("label",null,"时间范围：",-1)),n(c,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),onChange:$,style:{width:"120px"}},{default:Y(()=>[n(a,{label:"最近一周",value:"week"}),n(a,{label:"最近一月",value:"month"}),n(a,{label:"最近三月",value:"threeMonths"}),n(a,{label:"最近六月",value:"sixMonths"}),n(a,{label:"最近一年",value:"year"}),n(a,{label:"最近三年",value:"threeYears"}),n(a,{label:"全部",value:"all"}),n(a,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),b.value==="custom"?(r(),v("div",le,[e[6]||(e[6]=o("label",null,"开始日期：",-1)),n(h,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:f},null,8,["modelValue"])])):N("",!0),b.value==="custom"?(r(),v("div",se,[e[7]||(e[7]=o("label",null,"结束日期：",-1)),n(h,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:f},null,8,["modelValue"])])):N("",!0),o("div",oe,[e[8]||(e[8]=o("label",null,"图表类型：",-1)),n(c,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),onChange:f,style:{width:"120px"}},{default:Y(()=>[n(a,{label:"折线图",value:"line"}),n(a,{label:"柱状图",value:"bar"}),n(a,{label:"散点图",value:"scatter"}),n(a,{label:"面积图",value:"area"})]),_:1},8,["modelValue"])]),o("div",ne,[e[9]||(e[9]=o("label",null,"Y轴字段：",-1)),n(c,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value=t),multiple:"",placeholder:"选择要显示的字段",onChange:f,style:{width:"250px"}},{default:Y(()=>[(r(!0),v(I,null,A(O.value,t=>(r(),J(a,{key:t.key,label:t.label,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n(m,{type:"primary",onClick:f},{default:Y(()=>[...e[10]||(e[10]=[z("更新图表",-1)])]),_:1}),n(m,{onClick:H},{default:Y(()=>[...e[11]||(e[11]=[z("重置缩放",-1)])]),_:1})])]),o("div",{ref_key:"chartContainer",ref:S,class:"chart-container"},null,512),y.value.length>0?(r(),v("div",de,[o("div",re,[o("div",ie,[o("div",ue,x(y.value.length),1),e[12]||(e[12]=o("div",{class:"stat-label"},"总记录数",-1))]),(r(!0),v(I,null,A(u.value,t=>(r(),v("div",{class:"stat-card",key:t},[o("div",ce,x(T(t).avg),1),o("div",ve,x(V(t))+"平均值",1)]))),128)),(r(!0),v(I,null,A(u.value,t=>(r(),v("div",{class:"stat-card",key:"min-"+t},[o("div",me,x(T(t).min),1),o("div",pe,x(V(t))+"最小值",1)]))),128)),(r(!0),v(I,null,A(u.value,t=>(r(),v("div",{class:"stat-card",key:"max-"+t},[o("div",fe,x(T(t).max),1),o("div",he,x(V(t))+"最大值",1)]))),128))])])):N("",!0)])}}}),xe=W(ge,[["__scopeId","data-v-7be652f7"]]);export{xe as T};
