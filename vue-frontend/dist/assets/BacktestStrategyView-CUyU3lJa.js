import{d as J,r as Q,a as v,z as W,y as X,j as Z,c as m,b as u,g as w,e as l,w as s,i as d,E as f,F as k,A as D,k as N,t as S,O as ee,u as te,o as n,f as g,_ as ae}from"./index-CfZwY0h3.js";import{g as le,c as se,r as oe}from"./quantBacktestApi-Cs0GxInQ.js";import{g as F}from"./individualStockApi-DWUHXSFB.js";const re={class:"backtest-strategy-view"},ne={class:"strategy-config-panel"},ue={key:0,class:"strategy-params"},de={key:0,class:"strategy-description"},ie={class:"description-content"},ce={key:0,class:"params-info"},me=2,pe=J({__name:"BacktestStrategyView",setup(ye){te();const I=Z(),t=Q({strategyName:"",symbol:"",startDate:"",endDate:"",initialCash:1e6,strategyParams:{}}),Y=v([]),h=v([]),c=v(null),C=v(!1),q=v(""),V=v(!1),U=W(()=>!!t.strategyName&&!!t.symbol&&!!t.startDate&&!!t.endDate),O=((o,e)=>{let r;return(...b)=>{clearTimeout(r),r=setTimeout(()=>o.apply(null,b),e)}})(async(o="")=>{try{V.value=!0;const e={page:1,page_size:50,keyword:o.trim()},r=await F(e);h.value=r.data}catch(e){console.error("搜索股票列表失败:",e)}finally{V.value=!1}},300),z=o=>{const e=(o??"").trim();if(q.value=e,e.length===0){V.value=!1,h.value.length===0&&L();return}e.length>=me?O(e):V.value=!1},M=o=>{const e=Y.value.find(r=>r.name===o);e&&(c.value=e,t.strategyParams={},e.params&&Object.keys(e.params).forEach(r=>{t.strategyParams[r]=e.params[r].default}))},R=async()=>{if(!U.value){f.warning("请填写完整的回测配置");return}C.value=!0;try{const o={strategy_name:t.strategyName,stock_code:t.symbol,start_date:t.startDate,end_date:t.endDate,initial_cash:t.initialCash,strategy_params:t.strategyParams},e=await se(o);f.success("回测任务创建成功"),ee.confirm("回测任务已创建，是否立即运行？","提示",{confirmButtonText:"立即运行",cancelButtonText:"稍后运行",type:"info"}).then(async()=>{await j(e.task_id)}).catch(()=>{})}catch(o){console.error("创建回测任务失败:",o),f.error("创建回测任务失败")}finally{C.value=!1}},j=async o=>{try{await oe(o),f.success("回测任务已启动")}catch(e){console.error("运行回测任务失败:",e),f.error("运行回测任务失败")}},A=()=>{t.strategyName="",t.symbol="",t.startDate="",t.endDate="",t.initialCash=1e6,t.strategyParams={},c.value=null},H=async()=>{try{const o=await le();Y.value=o}catch(o){console.error("加载策略列表失败:",o),f.error("加载策略列表失败")}},L=async()=>{try{const e=await F({page:1,page_size:100});h.value=e.data}catch(o){console.error("加载股票列表失败:",o),f.error("加载股票列表失败")}};return X(async()=>{await Promise.all([H(),L()]);const o=new Date,e=new Date;e.setFullYear(o.getFullYear()-1),t.endDate=o.toISOString().split("T")[0],t.startDate=e.toISOString().split("T")[0];const r=I.query.strategy;r&&(t.strategyName=r,M(r))}),(o,e)=>{const r=d("el-option"),b=d("el-select"),p=d("el-form-item"),_=d("el-col"),P=d("el-row"),T=d("el-date-picker"),B=d("el-input-number"),$=d("el-input"),G=d("el-switch"),x=d("el-button"),K=d("el-form"),E=d("el-card");return n(),m("div",re,[e[11]||(e[11]=u("div",{class:"page-header"},[u("h1",null,"创建回测任务"),u("p",null,"选择策略并配置参数，创建回测任务")],-1)),u("div",ne,[l(E,null,{header:s(()=>[...e[5]||(e[5]=[u("div",{class:"card-header"},[u("span",null,"策略配置")],-1)])]),default:s(()=>[l(K,{model:t,"label-width":"120px",class:"strategy-form"},{default:s(()=>[l(P,{gutter:20},{default:s(()=>[l(_,{span:12},{default:s(()=>[l(p,{label:"选择策略",required:""},{default:s(()=>[l(b,{modelValue:t.strategyName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.strategyName=a),placeholder:"请选择策略",class:"full-width",onChange:M},{default:s(()=>[(n(!0),m(k,null,D(Y.value,a=>(n(),g(r,{key:a.name,label:a.description,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:s(()=>[l(p,{label:"股票代码",required:""},{default:s(()=>[l(b,{modelValue:t.symbol,"onUpdate:modelValue":e[1]||(e[1]=a=>t.symbol=a),placeholder:"请选择股票代码",filterable:"",remote:"","remote-method":z,loading:V.value,clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),m(k,null,D(h.value,a=>(n(),g(r,{key:a.code,label:`${a.code} - ${a.name}`,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),l(P,{gutter:20},{default:s(()=>[l(_,{span:8},{default:s(()=>[l(p,{label:"开始日期",required:""},{default:s(()=>[l(T,{modelValue:t.startDate,"onUpdate:modelValue":e[2]||(e[2]=a=>t.startDate=a),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:8},{default:s(()=>[l(p,{label:"结束日期",required:""},{default:s(()=>[l(T,{modelValue:t.endDate,"onUpdate:modelValue":e[3]||(e[3]=a=>t.endDate=a),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:8},{default:s(()=>[l(p,{label:"初始资金"},{default:s(()=>[l(B,{modelValue:t.initialCash,"onUpdate:modelValue":e[4]||(e[4]=a=>t.initialCash=a),min:1e4,step:1e4,precision:0,class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),c.value&&c.value.params?(n(),m("div",ue,[e[6]||(e[6]=u("h3",null,"策略参数",-1)),l(P,{gutter:20},{default:s(()=>[(n(!0),m(k,null,D(c.value.params,(a,i)=>(n(),g(_,{span:8,key:i},{default:s(()=>[l(p,{label:a.description},{default:s(()=>[a.type==="int"?(n(),g(B,{key:0,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,min:1,precision:0,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="string"?(n(),g($,{key:1,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="float"?(n(),g(B,{key:2,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,precision:2,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="boolean"?(n(),g(G,{key:3,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y},null,8,["modelValue","onUpdate:modelValue"])):w("",!0)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})])):w("",!0),l(p,null,{default:s(()=>[l(x,{type:"primary",onClick:R,loading:C.value,disabled:!U.value},{default:s(()=>[...e[7]||(e[7]=[N(" 创建回测任务 ",-1)])]),_:1},8,["loading","disabled"]),l(x,{onClick:A},{default:s(()=>[...e[8]||(e[8]=[N("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),c.value?(n(),m("div",de,[l(E,null,{header:s(()=>[...e[9]||(e[9]=[u("div",{class:"card-header"},[u("span",null,"策略说明")],-1)])]),default:s(()=>[u("div",ie,[u("h3",null,S(c.value.description),1),c.value.params?(n(),m("div",ce,[e[10]||(e[10]=u("h4",null,"参数说明：",-1)),u("ul",null,[(n(!0),m(k,null,D(c.value.params,(a,i)=>(n(),m("li",{key:i},[u("strong",null,S(a.description),1),N(": "+S(a.type)+"类型，默认值: "+S(a.default),1)]))),128))])])):w("",!0)])]),_:1})])):w("",!0)])}}}),he=ae(pe,[["__scopeId","data-v-2be300fd"]]);export{he as default};
