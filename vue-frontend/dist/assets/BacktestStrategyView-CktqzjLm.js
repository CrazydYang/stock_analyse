import{d as J,r as Q,a as v,z as W,y as X,j as Z,c as m,b as u,g as b,e as s,w as o,i as d,E as g,F as h,A as w,k as U,t as k,O as ee,u as te,o as n,f as _,_ as ae}from"./index-CK7s_MHQ.js";import{g as le,c as se,r as oe}from"./quantBacktestApi-Cish-uXo.js";import{g as F}from"./individualStockApi-CkR9jVyU.js";const re={class:"backtest-strategy-view"},ne={class:"strategy-config-panel"},ue={key:0,class:"strategy-params"},de={key:0,class:"strategy-description"},ie={class:"description-content"},ce={key:0,class:"params-info"},me=J({__name:"BacktestStrategyView",setup(pe){te();const q=Z(),t=Q({strategyName:"",symbol:"",startDate:"",endDate:"",initialCash:1e6,strategyParams:{}}),D=v([]),S=v([]),c=v(null),Y=v(!1),E=v(""),P=v(!1),M=W(()=>!!t.strategyName&&!!t.symbol&&!!t.startDate&&!!t.endDate),I=((l,e)=>{let r;return(...V)=>{clearTimeout(r),r=setTimeout(()=>l.apply(null,V),e)}})(async(l="")=>{try{P.value=!0;const e={page:1,page_size:50,keyword:l.trim()},r=await F(e);S.value=r.data}catch(e){console.error("搜索股票列表失败:",e)}finally{P.value=!1}},300),O=l=>{E.value=l,(l.length>=2||l==="")&&I(l)},N=l=>{const e=D.value.find(r=>r.name===l);e&&(c.value=e,t.strategyParams={},e.params&&Object.keys(e.params).forEach(r=>{t.strategyParams[r]=e.params[r].default}))},z=async()=>{if(!M.value){g.warning("请填写完整的回测配置");return}Y.value=!0;try{const l={strategy_name:t.strategyName,stock_code:t.symbol,start_date:t.startDate,end_date:t.endDate,initial_cash:t.initialCash,strategy_params:t.strategyParams},e=await se(l);g.success("回测任务创建成功"),ee.confirm("回测任务已创建，是否立即运行？","提示",{confirmButtonText:"立即运行",cancelButtonText:"稍后运行",type:"info"}).then(async()=>{await j(e.task_id)}).catch(()=>{})}catch(l){console.error("创建回测任务失败:",l),g.error("创建回测任务失败")}finally{Y.value=!1}},j=async l=>{try{await oe(l),g.success("回测任务已启动")}catch(e){console.error("运行回测任务失败:",e),g.error("运行回测任务失败")}},R=()=>{t.strategyName="",t.symbol="",t.startDate="",t.endDate="",t.initialCash=1e6,t.strategyParams={},c.value=null},$=async()=>{try{const l=await le();D.value=l}catch(l){console.error("加载策略列表失败:",l),g.error("加载策略列表失败")}},A=async()=>{try{const e=await F({page:1,page_size:100});S.value=e.data}catch(l){console.error("加载股票列表失败:",l),g.error("加载股票列表失败")}};return X(async()=>{await Promise.all([$(),A()]);const l=new Date,e=new Date;e.setFullYear(l.getFullYear()-1),t.endDate=l.toISOString().split("T")[0],t.startDate=e.toISOString().split("T")[0];const r=q.query.strategy;r&&(t.strategyName=r,N(r))}),(l,e)=>{const r=d("el-option"),V=d("el-select"),p=d("el-form-item"),f=d("el-col"),C=d("el-row"),L=d("el-date-picker"),B=d("el-input-number"),K=d("el-input"),G=d("el-switch"),T=d("el-button"),H=d("el-form"),x=d("el-card");return n(),m("div",re,[e[11]||(e[11]=u("div",{class:"page-header"},[u("h1",null,"创建回测策略"),u("p",null,"选择策略并配置参数，创建回测任务")],-1)),u("div",ne,[s(x,null,{header:o(()=>[...e[5]||(e[5]=[u("div",{class:"card-header"},[u("span",null,"策略配置")],-1)])]),default:o(()=>[s(H,{model:t,"label-width":"120px",class:"strategy-form"},{default:o(()=>[s(C,{gutter:20},{default:o(()=>[s(f,{span:12},{default:o(()=>[s(p,{label:"选择策略",required:""},{default:o(()=>[s(V,{modelValue:t.strategyName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.strategyName=a),placeholder:"请选择策略",class:"full-width",onChange:N},{default:o(()=>[(n(!0),m(h,null,w(D.value,a=>(n(),_(r,{key:a.name,label:a.description,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(f,{span:12},{default:o(()=>[s(p,{label:"股票代码",required:""},{default:o(()=>[s(V,{modelValue:t.symbol,"onUpdate:modelValue":e[1]||(e[1]=a=>t.symbol=a),placeholder:"请选择股票代码",filterable:"",remote:"","remote-method":O,loading:P.value,clearable:"",style:{width:"100%"}},{default:o(()=>[(n(!0),m(h,null,w(S.value,a=>(n(),_(r,{key:a.code,label:`${a.code} - ${a.name}`,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),s(C,{gutter:20},{default:o(()=>[s(f,{span:8},{default:o(()=>[s(p,{label:"开始日期",required:""},{default:o(()=>[s(L,{modelValue:t.startDate,"onUpdate:modelValue":e[2]||(e[2]=a=>t.startDate=a),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),s(f,{span:8},{default:o(()=>[s(p,{label:"结束日期",required:""},{default:o(()=>[s(L,{modelValue:t.endDate,"onUpdate:modelValue":e[3]||(e[3]=a=>t.endDate=a),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),s(f,{span:8},{default:o(()=>[s(p,{label:"初始资金"},{default:o(()=>[s(B,{modelValue:t.initialCash,"onUpdate:modelValue":e[4]||(e[4]=a=>t.initialCash=a),min:1e4,step:1e4,precision:0,class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),c.value&&c.value.params?(n(),m("div",ue,[e[6]||(e[6]=u("h3",null,"策略参数",-1)),s(C,{gutter:20},{default:o(()=>[(n(!0),m(h,null,w(c.value.params,(a,i)=>(n(),_(f,{span:8,key:i},{default:o(()=>[s(p,{label:a.description},{default:o(()=>[a.type==="int"?(n(),_(B,{key:0,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,min:1,precision:0,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="string"?(n(),_(K,{key:1,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="float"?(n(),_(B,{key:2,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y,precision:2,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="boolean"?(n(),_(G,{key:3,modelValue:t.strategyParams[i],"onUpdate:modelValue":y=>t.strategyParams[i]=y},null,8,["modelValue","onUpdate:modelValue"])):b("",!0)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})])):b("",!0),s(p,null,{default:o(()=>[s(T,{type:"primary",onClick:z,loading:Y.value,disabled:!M.value},{default:o(()=>[...e[7]||(e[7]=[U(" 创建回测任务 ",-1)])]),_:1},8,["loading","disabled"]),s(T,{onClick:R},{default:o(()=>[...e[8]||(e[8]=[U("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),c.value?(n(),m("div",de,[s(x,null,{header:o(()=>[...e[9]||(e[9]=[u("div",{class:"card-header"},[u("span",null,"策略说明")],-1)])]),default:o(()=>[u("div",ie,[u("h3",null,k(c.value.description),1),c.value.params?(n(),m("div",ce,[e[10]||(e[10]=u("h4",null,"参数说明：",-1)),u("ul",null,[(n(!0),m(h,null,w(c.value.params,(a,i)=>(n(),m("li",{key:i},[u("strong",null,k(a.description),1),U(": "+k(a.type)+"类型，默认值: "+k(a.default),1)]))),128))])])):b("",!0)])]),_:1})])):b("",!0)])}}}),Ve=ae(me,[["__scopeId","data-v-9542fa7b"]]);export{Ve as default};
