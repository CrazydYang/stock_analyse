import{d as U,a as K,G as B,C as P,M as R,N as G,c as x,b as p,g as W,t as C,O as H,o as D,_ as J,P as z,r as E,e as n,w as s,i as y,E as F,f as I,F as Z,A as j,k as O}from"./index-QbIf-jBq.js";import{i as Q}from"./index-OzhOYD-U.js";const X={class:"stock-kline-chart-container"},ee={class:"chart-header"},te={key:0},ae=U({__name:"StockKLineChart",props:{title:{default:""},stockCode:{},stockName:{default:""},klineData:{},tradeSignals:{default:()=>[]},height:{default:"600px"}},setup(d){H(b=>({"7a8900b8":e.height}));const e=d,c=K();let o=null;const u=()=>{c.value&&(o&&o.dispose(),o=Q(c.value),v(),window.addEventListener("resize",V))},v=()=>{if(!o||!e.klineData||e.klineData.length===0)return;const b=e.klineData.map(t=>t.date),M=e.klineData.map(t=>[t.open_price,t.close_price,t.low_price,t.high_price]),S=t=>t?t.replace(/[^0-9]/g,""):"",N=new Map;b.forEach((t,k)=>{N.set(S(t),k)});const Y=(t,k)=>{if(!t||!Array.isArray(t)||t.length===0)return[];const i=[...t].filter(l=>l.type===k).sort((l,g)=>{const f=S(l.date),_=S(g.date);return f.localeCompare(_)}),h=new Set;return console.log(`生成${k}信号标记，数量:`,i.length),k==="sell"&&console.log("卖出信号原始数据:",JSON.stringify(i)),i.map(l=>{const g=N.get(S(l.date));if(g===void 0)return console.log(`信号日期${l.date}不在K线数据范围内`),null;const f=S(l.date);if(h.has(f))return console.log(`日期${l.date}已有标记，跳过`),null;h.add(f);const _=k==="buy";return{name:_?"买入点":"卖出点",coord:[b[g],l.price],symbol:"arrow",symbolSize:50,symbolRotate:_?0:180,symbolOffset:[0,_?-100:20],value:l.price,itemStyle:{color:_?"#FF0000":"#00FF00",borderColor:"#fff",borderWidth:2},label:{show:!0,color:"#fff",backgroundColor:"rgba(255,0,0,0.7)",padding:[5,10],borderRadius:4,position:_?"top":"bottom",formatter:_?`买入
${l.price.toFixed(2)}元`:`卖出
${l.price.toFixed(2)}元`,fontSize:14,fontWeight:"bold"},tooltip:{formatter:_?`买入
价格: ${l.price.toFixed(2)}
${l.description||""}`:`卖出
价格: ${l.price.toFixed(2)}
${l.description||""}`}}}).filter(l=>l!==null)};console.log("更新图表，交易信号数量:",e.tradeSignals.length),console.log("交易信号详情:",JSON.stringify(e.tradeSignals));const L=Y(e.tradeSignals,"buy"),r=Y(e.tradeSignals,"sell");console.log("生成的买入信号数量:",L.length),console.log("生成的卖出信号数量:",r.length),console.log("卖出信号详情:",JSON.stringify(r));const a={title:{text:e.title||`${e.stockName}(${e.stockCode})K线图`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:t=>{let i=`<div style="font-weight:bold;margin-bottom:5px;">${t[0].axisValue}</div>`;return t.forEach(h=>{const l=h.color,g=h.seriesName,f=h.value;g==="K线"&&(i+=`<div style="color:${l};">${g}</div>`,i+=`<div>开盘价: ${f[0]}</div>`,i+=`<div>收盘价: ${f[1]}</div>`,i+=`<div>最低价: ${f[2]}</div>`,i+=`<div>最高价: ${f[3]}</div>`)}),i}},grid:{left:"10%",right:"10%",top:"15%",bottom:"15%"},xAxis:{type:"category",data:b,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1}},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",bottom:"5%",start:0,end:100}],series:[{name:"K线",type:"candlestick",data:M.map(t=>[t[0],t[1],t[3],t[2]]),markPoint:{symbol:"arrow",symbolSize:50,data:[...L,...r],clipByCoordinateSystem:!1,silent:!1,animation:!1,avoidLabelOverlap:!0,zlevel:10,emphasis:{disabled:!1},label:{fontSize:14,fontWeight:"bold",padding:[5,10],borderRadius:4,show:!0,formatter:function(t){return t.data&&t.data.name==="卖出点"?`卖出
${t.data.value.toFixed(2)}元`:t.data&&t.data.name==="买入点"?`买入
${t.data.value.toFixed(2)}元`:t.name}},itemStyle:{borderWidth:2,borderColor:"#fff",color:function(t){return t.data.name==="卖出点"?"#00FF00":"#FF0000"}}},itemStyle:{color:"#ec0000",color0:"#00da3c",borderColor:"#8A0000",borderColor0:"#008F28"}}]};o.setOption(a,!0)},V=()=>{o?.resize()};return B([()=>e.klineData,()=>e.tradeSignals],()=>{R(()=>{v()})},{deep:!0,immediate:!0}),B(()=>e.tradeSignals,()=>{R(()=>{v()})},{deep:!0,immediate:!0}),P(()=>{R(()=>{u()})}),G(()=>{o&&(o.dispose(),o=null),window.removeEventListener("resize",V)}),(b,M)=>(D(),x("div",X,[p("div",ee,[b.title?(D(),x("h3",te,C(b.title),1)):W("",!0)]),p("div",{ref_key:"chartContainer",ref:c,class:"chart-container"},null,512)]))}}),oe=J(ae,[["__scopeId","data-v-517c2dc2"]]),A="/django/api/individual_stock";async function ne(d,e,c,o=""){try{const u={};return e&&(u.start_date=e),c&&(u.end_date=c),o&&(u.adjust=o),(await z.get(`${A}/stocks/${d}/history/`,{params:u})).data}catch(u){throw console.error(`获取股票 ${d} 历史数据失败:`,u),u}}async function re(d){try{return(await z.get(`${A}/stocks/${d}/info/`)).data}catch(e){throw console.error(`获取股票 ${d} 详细信息失败:`,e),e}}async function le(d=1,e=20){try{const c={page:d.toString(),page_size:e.toString()},o=await z.get(`${A}/stocks/`,{params:c});return{total:o.data.total,data:o.data.data}}catch(c){throw console.error("获取股票列表失败:",c),c}}function w(d){const e=typeof d=="string"?new Date(d):d,c=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${c}${o}${u}`}function $(d){const e=new Date;return e.setDate(e.getDate()-d),e}const se={class:"stock-kline-view"},ce={class:"control-panel"},de={key:0,class:"chart-container"},ie={class:"card-header"},ue={class:"stock-info"},pe={key:1,class:"empty-state"},fe=U({__name:"StockKLineView",setup(d){const e=E({stockCode:"",stockName:"",dateRangeType:"month",startDate:"",endDate:""}),c=K([]),o=E({code:"",name:"",industry:"",listDate:"",totalMarketCap:0,circulatingMarketCap:0}),u=K([]),v=K(!1),V=r=>{const a=u.value.find(t=>t.code===r);a&&(e.stockCode=a.code,e.stockName=a.name,b(a.code))},b=async r=>{try{const a=await re(r);o.code=a.code,o.name=a.name,o.industry=a.industry,o.listDate=a.list_date,o.totalMarketCap=a.total_market_cap,o.circulatingMarketCap=a.circulating_market_cap}catch(a){console.error("获取股票详细信息失败:",a),F.error("获取股票详细信息失败")}},M=()=>{const a=w(new Date);switch(e.endDate=a,e.dateRangeType){case"week":e.startDate=w($(7));break;case"month":e.startDate=w($(30));break;case"threeMonths":e.startDate=w($(90));break;case"sixMonths":e.startDate=w($(180));break;case"year":e.startDate=w($(365));break;case"threeYears":e.startDate=w($(365*3));break;case"all":e.startDate="";break}},S=async()=>{if(!e.stockCode){F.warning("请选择股票");return}v.value=!0;try{let r=e.startDate,a=e.endDate;r&&(r=r.replace(/-/g,"")),a&&(a=a.replace(/-/g,""));const t=await ne(e.stockCode,r,a);c.value=t,t.length===0&&F.warning("未查询到股票历史数据")}catch(r){console.error("获取股票数据失败:",r),F.error("获取股票数据失败")}finally{v.value=!1}},N=()=>{e.stockCode="",e.stockName="",e.dateRangeType="month",e.startDate="",e.endDate="",c.value=[],o.code="",o.name="",o.industry="",o.listDate="",o.totalMarketCap=0,o.circulatingMarketCap=0},Y=r=>r?r>=1e8?`${(r/1e8).toFixed(2)}亿`:r>=1e4?`${(r/1e4).toFixed(2)}万`:r.toString():"未知",L=async()=>{try{v.value=!0;const{data:r}=await le(1,100);u.value=r}catch(r){console.error("加载股票列表失败:",r),F.error("加载股票列表失败")}finally{v.value=!1}};return P(()=>{M(),L()}),(r,a)=>{const t=y("el-option"),k=y("el-select"),i=y("el-form-item"),h=y("el-col"),l=y("el-row"),g=y("el-date-picker"),f=y("el-button"),_=y("el-form"),T=y("el-card"),q=y("el-empty");return D(),x("div",se,[a[7]||(a[7]=p("div",{class:"page-header"},[p("h1",null,"股票K线图分析"),p("p",null,"查看个股历史K线数据，支持技术指标分析")],-1)),p("div",ce,[n(T,null,{header:s(()=>[...a[4]||(a[4]=[p("div",{class:"card-header"},[p("span",null,"查询条件")],-1)])]),default:s(()=>[n(_,{model:e,"label-width":"100px",class:"query-form"},{default:s(()=>[n(l,{gutter:20},{default:s(()=>[n(h,{span:8},{default:s(()=>[n(i,{label:"股票代码"},{default:s(()=>[n(k,{modelValue:e.stockCode,"onUpdate:modelValue":a[0]||(a[0]=m=>e.stockCode=m),placeholder:"请选择股票",class:"full-width",onChange:V},{default:s(()=>[(D(!0),x(Z,null,j(u.value,m=>(D(),I(t,{key:m.code,label:`${m.code} ${m.name}`,value:m.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(h,{span:8},{default:s(()=>[n(i,{label:"时间范围"},{default:s(()=>[n(k,{modelValue:e.dateRangeType,"onUpdate:modelValue":a[1]||(a[1]=m=>e.dateRangeType=m),onChange:M,class:"full-width"},{default:s(()=>[n(t,{label:"最近一周",value:"week"}),n(t,{label:"最近一月",value:"month"}),n(t,{label:"最近三月",value:"threeMonths"}),n(t,{label:"最近六月",value:"sixMonths"}),n(t,{label:"最近一年",value:"year"}),n(t,{label:"最近三年",value:"threeYears"}),n(t,{label:"全部",value:"all"}),n(t,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e.dateRangeType==="custom"?(D(),I(l,{key:0,gutter:20},{default:s(()=>[n(h,{span:8},{default:s(()=>[n(i,{label:"开始日期"},{default:s(()=>[n(g,{modelValue:e.startDate,"onUpdate:modelValue":a[2]||(a[2]=m=>e.startDate=m),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),n(h,{span:8},{default:s(()=>[n(i,{label:"结束日期"},{default:s(()=>[n(g,{modelValue:e.endDate,"onUpdate:modelValue":a[3]||(a[3]=m=>e.endDate=m),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):W("",!0),n(i,null,{default:s(()=>[n(f,{type:"primary",onClick:S},{default:s(()=>[...a[5]||(a[5]=[O("查询",-1)])]),_:1}),n(f,{onClick:N},{default:s(()=>[...a[6]||(a[6]=[O("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),c.value.length>0?(D(),x("div",de,[n(T,null,{header:s(()=>[p("div",ie,[p("span",null,C(o.name)+"("+C(o.code)+") K线图",1),p("div",ue,[p("span",null,"行业: "+C(o.industry||"未知"),1),p("span",null,"上市日期: "+C(o.listDate||"未知"),1),p("span",null,"总市值: "+C(Y(o.totalMarketCap)),1),p("span",null,"流通市值: "+C(Y(o.circulatingMarketCap)),1)])])]),default:s(()=>[n(oe,{"stock-code":o.code,"stock-name":o.name,"kline-data":c.value,height:"600px","show-volume":!0},null,8,["stock-code","stock-name","kline-data"])]),_:1})])):(D(),x("div",pe,[n(q,{description:"请选择股票并查询数据"})]))])}}}),_e=J(fe,[["__scopeId","data-v-7cce85c9"]]);export{_e as default};
