import{x as Q,d as q,H as T,a as _,I as X,f as A,w as s,i as n,c as $,g as J,b as l,e as a,k as c,t as p,F as Y,D as Z,l as x,L as M,a5 as ee,E as U,o as w,_ as G,y as te,N as ae,a6 as se,M as le,J as oe,K as ne,h as re}from"./index-B66z1j89.js";const ie="/django/api/individual_stock/strategy-results",ue=async(z={})=>await Q.get(`${ie}/`,{params:{page:z.page||1,page_size:z.page_size||20,strategy_name:z.strategy_name}}),de={key:0,class:"strategy-detail-content"},ce={class:"strategy-info-section"},pe={class:"strategy-info"},ge={class:"selected-stocks-section"},_e={class:"card-header"},ve={class:"header-actions"},ye={key:0},fe={key:1},me={key:0,class:"pagination-container"},he={class:"dialog-footer"},be=q({__name:"StrategyResultDetailDialog",props:{visible:{type:Boolean,default:!1},strategyResult:{default:null}},emits:["update:visible"],setup(z,{emit:R}){const u=z,S=R,v=T({get:()=>u.visible,set:e=>S("update:visible",e)}),D=T(()=>u.strategyResult?`策略详情 - ${u.strategyResult.strategy_name}`:"策略详情"),b=_(""),y=_(1),C=_(20),g=_([]),I=T(()=>{if(!u.strategyResult?.strategy_result)return[];let e=u.strategyResult.strategy_result;if(b.value){const d=b.value.toLowerCase();e=e.filter(f=>f.stock_code?.toLowerCase().includes(d)||f.stock_name?.toLowerCase().includes(d))}const t=(y.value-1)*C.value,r=t+C.value;return e.slice(t,r)}),N=()=>{if(!u.strategyResult?.strategy_result?.length){g.value=[];return}const e=u.strategyResult.strategy_result[0],t=[];e.stock_code!==void 0&&t.push({prop:"stock_code",label:"股票代码",width:120,align:"center",sortable:!0}),e.stock_name!==void 0&&t.push({prop:"stock_name",label:"股票名称",minWidth:120,showOverflowTooltip:!0,sortable:!0}),e.buy_signal!==void 0&&t.push({prop:"buy_signal",label:"买入信号",minWidth:150,showOverflowTooltip:!0});const r=["stock_code","stock_name","buy_signal"];Object.keys(e).forEach(d=>{if(!r.includes(d)){const f=e[d];t.push({prop:d,label:d,minWidth:120,align:typeof f=="number"?"center":"left",sortable:!0,showOverflowTooltip:!0,type:typeof f=="number"?"number":"string"})}}),g.value=t},E=e=>e==null?"-":typeof e!="number"?String(e):e.toFixed(2),j=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}},F=e=>{C.value=e,y.value=1},O=e=>{y.value=e},B=()=>{if(!u.strategyResult?.strategy_result?.length){U.warning("没有数据可导出");return}try{const e=u.strategyResult.strategy_result,t=g.value.map(k=>k.label).join(","),r=e.map(k=>g.value.map(V=>k[V.prop]||"").join(",")).join(`
`),d=`${t}
${r}`,f=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),h=URL.createObjectURL(f);m.setAttribute("href",h),m.setAttribute("download",`${u.strategyResult.strategy_name}_选股结果.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),U.success("数据导出成功")}catch(e){console.error("导出数据失败:",e),U.error("导出数据失败")}},L=()=>{v.value=!1,b.value="",y.value=1};return X(()=>u.strategyResult,()=>{u.strategyResult&&(N(),b.value="",y.value=1)},{immediate:!0}),(e,t)=>{const r=n("el-descriptions-item"),d=n("el-tag"),f=n("el-descriptions"),m=n("el-card"),h=n("el-icon"),k=n("el-input"),V=n("el-button"),K=n("el-table-column"),P=n("el-table"),i=n("el-pagination"),W=n("el-dialog");return w(),A(W,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=o=>v.value=o),title:D.value,width:"90%","before-close":L,"destroy-on-close":""},{footer:s(()=>[l("div",he,[a(V,{onClick:L},{default:s(()=>[...t[6]||(t[6]=[c("关闭",-1)])]),_:1})])]),default:s(()=>[e.strategyResult?(w(),$("div",de,[l("div",ce,[a(m,null,{header:s(()=>[...t[4]||(t[4]=[l("div",{class:"card-header"},[l("span",null,"策略基本信息")],-1)])]),default:s(()=>[l("div",pe,[a(f,{column:2,border:""},{default:s(()=>[a(r,{label:"策略ID"},{default:s(()=>[c(p(e.strategyResult.id),1)]),_:1}),a(r,{label:"策略名称"},{default:s(()=>[c(p(e.strategyResult.strategy_name),1)]),_:1}),a(r,{label:"策略描述",span:2},{default:s(()=>[c(p(e.strategyResult.strategy_description),1)]),_:1}),a(r,{label:"选股数量"},{default:s(()=>[a(d,{type:"info"},{default:s(()=>[c(p(e.strategyResult.strategy_result.length),1)]),_:1})]),_:1}),a(r,{label:"创建时间"},{default:s(()=>[c(p(j(e.strategyResult.created_at)),1)]),_:1}),a(r,{label:"更新时间"},{default:s(()=>[c(p(j(e.strategyResult.updated_at)),1)]),_:1})]),_:1})])]),_:1})]),l("div",ge,[a(m,null,{header:s(()=>[l("div",_e,[l("span",null,"选股结果 ("+p(e.strategyResult.strategy_result.length)+" 只股票)",1),l("div",ve,[a(k,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),placeholder:"搜索股票代码或名称",clearable:"",style:{width:"200px","margin-right":"10px"}},{prefix:s(()=>[a(h,null,{default:s(()=>[a(x(M))]),_:1})]),_:1},8,["modelValue"]),a(V,{icon:x(ee),onClick:B},{default:s(()=>[...t[5]||(t[5]=[c(" 导出数据 ",-1)])]),_:1},8,["icon"])])])]),default:s(()=>[a(P,{data:I.value,stripe:"",border:"",style:{width:"100%"},"default-sort":{prop:"stock_code",order:"ascending"},"max-height":"500"},{default:s(()=>[(w(!0),$(Y,null,Z(g.value,o=>(w(),A(K,{key:o.prop,prop:o.prop,label:o.label,width:o.width,"min-width":o.minWidth,align:o.align,sortable:o.sortable,"show-overflow-tooltip":o.showOverflowTooltip},{default:s(({row:H})=>[o.type==="number"?(w(),$("span",ye,p(E(H[o.prop])),1)):(w(),$("span",fe,p(H[o.prop]||"-"),1))]),_:2},1032,["prop","label","width","min-width","align","sortable","show-overflow-tooltip"]))),128))]),_:1},8,["data"]),e.strategyResult.strategy_result.length>10?(w(),$("div",me,[a(i,{"current-page":y.value,"onUpdate:currentPage":t[1]||(t[1]=o=>y.value=o),"page-size":C.value,"onUpdate:pageSize":t[2]||(t[2]=o=>C.value=o),total:I.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:O},null,8,["current-page","page-size","total"])])):J("",!0)]),_:1})])])):J("",!0)]),_:1},8,["modelValue","title"])}}}),we=G(be,[["__scopeId","data-v-d11b4316"]]),Ce={class:"strategy-result-list-view"},Re={class:"page-header"},ke={class:"header-content"},ze={class:"action-section"},Se={class:"search-section"},De={class:"search-form"},Ve={class:"table-section"},$e={class:"table-header"},xe={class:"table-info"},Le={class:"pagination-container"},Ue=q({__name:"StrategyResultListView",setup(z){const R=_(!1),u=_([]),S=_(""),v=_(1),D=_(20),b=_(0),y=_(!1),C=_(null),g=async()=>{try{R.value=!0;const e={page:v.value,page_size:D.value,strategy_name:S.value||void 0},t=await ue(e);t.code===200?(u.value=t.data.results,b.value=t.data.total):U.error(t.message||"获取策略结果列表失败")}catch(e){console.error("获取策略结果列表失败:",e),U.error("获取策略结果列表失败，请稍后重试")}finally{R.value=!1}},I=()=>{g()},N=()=>{v.value=1,g()},E=()=>{S.value="",v.value=1,g()},j=e=>{D.value=e,v.value=1,g()},F=e=>{v.value=e,g()},O=e=>{B(e)},B=e=>{C.value=e,y.value=!0},L=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}};return te(()=>{g()}),(e,t)=>{const r=n("el-button"),d=n("el-card"),f=n("el-icon"),m=n("el-input"),h=n("el-table-column"),k=n("el-tag"),V=n("el-table"),K=n("el-pagination"),P=ne("loading");return w(),$("div",Ce,[l("div",Re,[a(d,null,{default:s(()=>[l("div",ke,[t[5]||(t[5]=l("div",{class:"title-section"},[l("h2",null,"策略结果管理"),l("p",null,"查看和管理所有策略选股结果")],-1)),l("div",ze,[a(r,{type:"primary",icon:x(ae),onClick:I,loading:R.value},{default:s(()=>[...t[4]||(t[4]=[c(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),_:1})]),l("div",Se,[a(d,null,{default:s(()=>[l("div",De,[a(m,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=i=>S.value=i),placeholder:"请输入策略名称进行搜索",clearable:"",style:{width:"300px","margin-right":"10px"},onKeyup:se(N,["enter"])},{prefix:s(()=>[a(f,null,{default:s(()=>[a(x(M))]),_:1})]),_:1},8,["modelValue"]),a(r,{type:"primary",icon:x(M),onClick:N},{default:s(()=>[...t[6]||(t[6]=[c(" 搜索 ",-1)])]),_:1},8,["icon"]),a(r,{icon:x(le),onClick:E},{default:s(()=>[...t[7]||(t[7]=[c(" 重置 ",-1)])]),_:1},8,["icon"])])]),_:1})]),l("div",Ve,[a(d,null,{default:s(()=>[l("div",$e,[t[8]||(t[8]=l("h3",null,"策略结果列表",-1)),l("div",xe,[l("span",null,"共 "+p(b.value)+" 条记录",1)])]),oe((w(),A(V,{data:u.value,stripe:"",style:{width:"100%"},onRowClick:O,"row-style":"cursor: pointer;"},{default:s(()=>[a(h,{prop:"id",label:"ID",width:"80"}),a(h,{prop:"strategy_name",label:"策略名称","min-width":"200"}),a(h,{prop:"strategy_description",label:"策略描述","min-width":"300","show-overflow-tooltip":""}),a(h,{label:"选股数量",width:"120",align:"center"},{default:s(({row:i})=>[a(k,{type:"info"},{default:s(()=>[c(p(i.strategy_result.total_count),1)]),_:2},1024)]),_:1}),a(h,{label:"执行时间",width:"180",align:"center"},{default:s(({row:i})=>[c(p(L(i.strategy_result.execution_time)),1)]),_:1}),a(h,{label:"创建时间",width:"180",align:"center"},{default:s(({row:i})=>[c(p(L(i.created_at)),1)]),_:1}),a(h,{label:"操作",width:"120",align:"center"},{default:s(({row:i})=>[a(r,{type:"primary",size:"small",onClick:re(W=>B(i),["stop"])},{default:s(()=>[...t[9]||(t[9]=[c(" 查看详情 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,R.value]]),l("div",Le,[a(K,{"current-page":v.value,"onUpdate:currentPage":t[1]||(t[1]=i=>v.value=i),"page-size":D.value,"onUpdate:pageSize":t[2]||(t[2]=i=>D.value=i),total:b.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1})]),a(we,{visible:y.value,"onUpdate:visible":t[3]||(t[3]=i=>y.value=i),"strategy-result":C.value},null,8,["visible","strategy-result"])])}}}),Ne=G(Ue,[["__scopeId","data-v-c09d40a3"]]);export{Ne as default};
